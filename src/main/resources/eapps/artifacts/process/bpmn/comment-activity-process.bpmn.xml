<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:ecos="http://www.citeck.ru/ecos/bpmn/1.0" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" id="Definitions_6KoB1vp" name="Процесс комментарии/активности" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="8.2.0" ecos:workingCopySourceRef="" ecos:name_ml="{&quot;ru&quot;:&quot;Процесс комментарии/активности&quot;,&quot;en&quot;:&quot;Process comment/activity&quot;}" ecos:formRef="" ecos:autoDeleteEnabled="true" ecos:sectionRef="eproc/bpmn-section@DEFAULT" ecos:enabled="true" ecos:autoStartEnabled="true" ecos:defState="CONVERTED" ecos:processDefId="comment-activity-process" ecos:ecosType="emodel/type@comment-activity">
    <bpmn:process isExecutable="true" id="comment-activity-process">
        <bpmn:startEvent isInterrupting="true" name="" id="StartEvent_1ew9rff" ecos:documentation="{}" ecos:asyncConfig="{&quot;asyncBefore&quot;:false,&quot;asyncAfter&quot;:false,&quot;exclusive&quot;:true}" ecos:name_ml="{}" ecos:jobConfig="{&quot;jobPriority&quot;:null,&quot;jobRetryTimeCycle&quot;:null}">
            <bpmn:outgoing >Flow_12mq15r</bpmn:outgoing>
        </bpmn:startEvent>
        <bpmn:sequenceFlow sourceRef="StartEvent_1ew9rff" targetRef="Activity_0fhrd08" name="" id="Flow_12mq15r" ecos:name_ml="{}" ecos:conditionConfig="{&quot;fn&quot;:&quot;&quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="NONE"/>
        <bpmn:scriptTask scriptFormat="javascript" name="Подготовка данных" id="Activity_0fhrd08" ecos:documentation="{}" ecos:asyncConfig="{&quot;asyncBefore&quot;:false,&quot;asyncAfter&quot;:false,&quot;exclusive&quot;:true}" ecos:name_ml="{&quot;ru&quot;:&quot;Подготовка данных&quot;}" ecos:jobConfig="{&quot;jobPriority&quot;:null,&quot;jobRetryTimeCycle&quot;:null}" ecos:script="var data = document.load('data?json');&#10;execution.setVariable('data', data);">
            <bpmn:incoming >Flow_12mq15r</bpmn:incoming>
            <bpmn:outgoing >Flow_1qxvl67</bpmn:outgoing>
            <bpmn:script>var data = document.load('data?json');
                execution.setVariable('data', data);</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:exclusiveGateway default="Flow_0qqfary" name="" id="Gateway_0xfv2sw" ecos:documentation="{}" ecos:name_ml="{}">
            <bpmn:incoming >Flow_1qxvl67</bpmn:incoming>
            <bpmn:outgoing >Flow_0qqfary</bpmn:outgoing>
            <bpmn:outgoing >Flow_119jzqy</bpmn:outgoing>
            <bpmn:outgoing >Flow_11ali6u</bpmn:outgoing>
            <bpmn:outgoing >Flow_15dgncw</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow sourceRef="Activity_0fhrd08" targetRef="Gateway_0xfv2sw" name="" id="Flow_1qxvl67" ecos:name_ml="{}" ecos:conditionConfig="{&quot;fn&quot;:&quot;&quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="NONE"/>
        <bpmn:exclusiveGateway name="" id="Gateway_1y7qnhc" ecos:documentation="{}" ecos:name_ml="{}">
            <bpmn:incoming >Flow_0qqfary</bpmn:incoming>
            <bpmn:incoming >Flow_07q8xnr</bpmn:incoming>
            <bpmn:incoming >Flow_1itm20z</bpmn:incoming>
            <bpmn:incoming >Flow_0y0pl5q</bpmn:incoming>
            <bpmn:outgoing >Flow_0iz0be0</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow sourceRef="Gateway_0xfv2sw" targetRef="Gateway_1y7qnhc" name="" id="Flow_0qqfary" ecos:name_ml="{}" ecos:conditionConfig="{&quot;fn&quot;:&quot; &quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="NONE"/>
        <bpmn:endEvent name="" id="Event_1kdzl1s" ecos:documentation="{}" ecos:asyncConfig="{&quot;asyncBefore&quot;:false,&quot;asyncAfter&quot;:false,&quot;exclusive&quot;:true}" ecos:name_ml="{}" ecos:jobConfig="{&quot;jobPriority&quot;:null,&quot;jobRetryTimeCycle&quot;:null}">
            <bpmn:incoming >Flow_0iz0be0</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:sequenceFlow sourceRef="Gateway_0xfv2sw" targetRef="Activity_1rmer9f" name="Комментарий" id="Flow_119jzqy" ecos:name_ml="{&quot;ru&quot;:&quot;Комментарий&quot;}" ecos:conditionConfig="{&quot;fn&quot;:&quot;var type = document.load('type.id?str');\ntype === 'comment';&quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="SCRIPT"/>
        <bpmn:scriptTask scriptFormat="javascript" name="Создание комментария" id="Activity_1rmer9f" ecos:documentation="{}" ecos:asyncConfig="{&quot;asyncBefore&quot;:false,&quot;asyncAfter&quot;:false,&quot;exclusive&quot;:true}" ecos:name_ml="{&quot;ru&quot;:&quot;Создание комментария&quot;}" ecos:jobConfig="{&quot;jobPriority&quot;:null,&quot;jobRetryTimeCycle&quot;:null}" ecos:script="var data = execution.getVariable('data');&#10;&#10;var comment = Records.get('emodel/comment@');&#10;comment.att('record', data.get('record'));&#10;comment.att('text', data.get('text'));&#10;var newComment = comment.save();&#10;&#10;document.att('record', newComment.getId());&#10;document.save();">
            <bpmn:incoming >Flow_119jzqy</bpmn:incoming>
            <bpmn:outgoing >Flow_07q8xnr</bpmn:outgoing>
            <bpmn:script>var data = execution.getVariable('data');

                var comment = Records.get('emodel/comment@');
                comment.att('record', data.get('record'));
                comment.att('text', data.get('text'));
                var newComment = comment.save();

                document.att('record', newComment.getId());
                document.save();</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:sequenceFlow sourceRef="Activity_1rmer9f" targetRef="Gateway_1y7qnhc" name="" id="Flow_07q8xnr" ecos:name_ml="{}" ecos:conditionConfig="{&quot;fn&quot;:&quot; &quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="NONE"/>
        <bpmn:sequenceFlow sourceRef="Gateway_1y7qnhc" targetRef="Event_1kdzl1s" name="" id="Flow_0iz0be0" ecos:name_ml="{}" ecos:conditionConfig="{&quot;fn&quot;:&quot;&quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="NONE"/>
        <bpmn:sequenceFlow sourceRef="Gateway_0xfv2sw" targetRef="Activity_17e071g" name="Активность" id="Flow_11ali6u" ecos:name_ml="{&quot;ru&quot;:&quot;Активность&quot;}" ecos:conditionConfig="{&quot;fn&quot;:&quot;var type = document.load('type.typeDef.id?str');\ntype === 'ecos-activity';&quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="SCRIPT"/>
        <bpmn:scriptTask scriptFormat="javascript" name="Создание активности" id="Activity_17e071g" ecos:documentation="{}" ecos:asyncConfig="{&quot;asyncBefore&quot;:false,&quot;asyncAfter&quot;:false,&quot;exclusive&quot;:true}" ecos:name_ml="{&quot;ru&quot;:&quot;Создание активности&quot;}" ecos:jobConfig="{&quot;jobPriority&quot;:null,&quot;jobRetryTimeCycle&quot;:null}" ecos:script="var data = execution.getVariable('data');&#10;&#10;var activity = Records.get('emodel/activity@');&#10;activity.att('record', data.get('record'));&#10;activity.att('type', data.get('type'));&#10;activity.att('activityDate', data.get('activityDate'));&#10;activity.att('duration', data.get('duration'));&#10;activity.att('responsible', data.get('responsible'));&#10;activity.att('description', data.get('description'));&#10;var newActivity = activity.save();&#10;&#10;document.att('record', newActivity.getId());&#10;document.save();">
            <bpmn:incoming >Flow_11ali6u</bpmn:incoming>
            <bpmn:outgoing >Flow_1itm20z</bpmn:outgoing>
            <bpmn:script>var data = execution.getVariable('data');

                var activity = Records.get('emodel/activity@');
                activity.att('record', data.get('record'));
                activity.att('type', data.get('type'));
                activity.att('activityDate', data.get('activityDate'));
                activity.att('duration', data.get('duration'));
                activity.att('responsible', data.get('responsible'));
                activity.att('description', data.get('description'));
                var newActivity = activity.save();

                document.att('record', newActivity.getId());
                document.save();</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:sequenceFlow sourceRef="Activity_17e071g" targetRef="Gateway_1y7qnhc" name="" id="Flow_1itm20z" ecos:name_ml="{}" ecos:conditionConfig="{&quot;fn&quot;:&quot; &quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="NONE"/>
        <bpmn:sequenceFlow sourceRef="Gateway_0xfv2sw" targetRef="Activity_01jkhpe" name="Создание поручения" id="Flow_15dgncw" ecos:name_ml="{&quot;ru&quot;:&quot;Создание поручения&quot;}" ecos:conditionConfig="{&quot;fn&quot;:&quot;var type = document.load('type.id?str');\ntype === 'assignment';&quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="SCRIPT"/>
        <bpmn:scriptTask scriptFormat="javascript" name="Создание поручения" id="Activity_01jkhpe" ecos:documentation="{}" ecos:asyncConfig="{&quot;asyncBefore&quot;:false,&quot;asyncAfter&quot;:false,&quot;exclusive&quot;:true}" ecos:name_ml="{&quot;ru&quot;:&quot;Создание поручения&quot;}" ecos:jobConfig="{&quot;jobPriority&quot;:null,&quot;jobRetryTimeCycle&quot;:null}" ecos:script="var data = execution.getVariable('data');&#10;&#10;var assignment = Records.get('emodel/assignment-type@');&#10;assignment.att('title', data.get('title'));&#10;assignment.att('description', data.get('description'));&#10;assignment.att('dueDate', data.get('dueDate'));&#10;assignment.att('priority', data.get('priority'));&#10;assignment.att('initiator', data.get('initiator'));&#10;assignment.att('performer', data.get('performer'));&#10;assignment.att('assoc:associatedWith', data.get('assoc:associatedWith'));&#10;var newAssignment = assignment.save();&#10;&#10;document.att('record', newAssignment.getId());&#10;document.save();">
            <bpmn:incoming >Flow_15dgncw</bpmn:incoming>
            <bpmn:outgoing >Flow_0y0pl5q</bpmn:outgoing>
            <bpmn:script>var data = execution.getVariable('data');

                var assignment = Records.get('emodel/assignment-type@');
                assignment.att('title', data.get('title'));
                assignment.att('description', data.get('description'));
                assignment.att('dueDate', data.get('dueDate'));
                assignment.att('priority', data.get('priority'));
                assignment.att('initiator', data.get('initiator'));
                assignment.att('performer', data.get('performer'));
                assignment.att('assoc:associatedWith', data.get('assoc:associatedWith'));
                var newAssignment = assignment.save();

                document.att('record', newAssignment.getId());
                document.save();</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:sequenceFlow sourceRef="Activity_01jkhpe" targetRef="Gateway_1y7qnhc" name="" id="Flow_0y0pl5q" ecos:name_ml="{}" ecos:conditionConfig="{&quot;fn&quot;:&quot; &quot;,&quot;expression&quot;:&quot;&quot;,&quot;outcome&quot;:&quot;&quot;}" ecos:conditionType="NONE"/>
    </bpmn:process>
    <bpmndi:BPMNDiagram id="BPMNDiagram_1">
        <bpmndi:BPMNPlane  bpmnElement="comment-activity-process" id="BPMNPlane_1">
            <bpmndi:BPMNShape bpmnElement="StartEvent_1ew9rff" isExpanded="false" id="_BPMNShape_StartEvent_2">
                <dc:Bounds x="156.0" y="81.0" width="36.0" height="36.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Activity_0fhrd08" isExpanded="false" id="Activity_0w1hjse_di">
                <dc:Bounds x="250.0" y="59.0" width="100.0" height="80.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Gateway_0xfv2sw" isExpanded="false" id="Gateway_0xfv2sw_di">
                <dc:Bounds x="415.0" y="74.0" width="50.0" height="50.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Gateway_1y7qnhc" isExpanded="false" id="Gateway_1y7qnhc_di">
                <dc:Bounds x="735.0" y="74.0" width="50.0" height="50.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Event_1kdzl1s" isExpanded="false" id="Event_1kdzl1s_di">
                <dc:Bounds x="872.0" y="81.0" width="36.0" height="36.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Activity_1rmer9f" isExpanded="false" id="Activity_0caaso9_di">
                <dc:Bounds x="560.0" y="170.0" width="100.0" height="80.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Activity_17e071g" isExpanded="false" id="Activity_0absbpp_di">
                <dc:Bounds x="560.0" y="270.0" width="100.0" height="80.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Activity_01jkhpe" isExpanded="false" id="Activity_01xqzam_di">
                <dc:Bounds x="560.0" y="370.0" width="100.0" height="80.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNEdge bpmnElement="Flow_12mq15r" id="Flow_12mq15r_di">
                <di:waypoint x="192.0" y="99.0"/>
                <di:waypoint x="250.0" y="99.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_1qxvl67" id="Flow_1qxvl67_di">
                <di:waypoint x="350.0" y="99.0"/>
                <di:waypoint x="415.0" y="99.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0qqfary" id="Flow_0qqfary_di">
                <di:waypoint x="465.0" y="99.0"/>
                <di:waypoint x="735.0" y="99.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_119jzqy" id="Flow_119jzqy_di">
                <di:waypoint x="460.0" y="104.0"/>
                <di:waypoint x="460.0" y="210.0"/>
                <di:waypoint x="560.0" y="210.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_07q8xnr" id="Flow_07q8xnr_di">
                <di:waypoint x="660.0" y="210.0"/>
                <di:waypoint x="760.0" y="210.0"/>
                <di:waypoint x="760.0" y="124.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0iz0be0" id="Flow_0iz0be0_di">
                <di:waypoint x="785.0" y="99.0"/>
                <di:waypoint x="872.0" y="99.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_11ali6u" id="Flow_11ali6u_di">
                <di:waypoint x="450.0" y="114.0"/>
                <di:waypoint x="450.0" y="310.0"/>
                <di:waypoint x="560.0" y="310.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_1itm20z" id="Flow_1itm20z_di">
                <di:waypoint x="660.0" y="310.0"/>
                <di:waypoint x="760.0" y="310.0"/>
                <di:waypoint x="760.0" y="124.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_15dgncw" id="Flow_15dgncw_di">
                <di:waypoint x="440.0" y="124.0"/>
                <di:waypoint x="440.0" y="410.0"/>
                <di:waypoint x="560.0" y="410.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0y0pl5q" id="Flow_0y0pl5q_di">
                <di:waypoint x="660.0" y="410.0"/>
                <di:waypoint x="760.0" y="410.0"/>
                <di:waypoint x="760.0" y="124.0"/>
            </bpmndi:BPMNEdge>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</bpmn:definitions>
