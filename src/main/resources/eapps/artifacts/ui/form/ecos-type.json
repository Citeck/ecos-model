{
  "id": "ecos-type",
  "formKey": "",
  "title": {
    "en": "Type form"
  },
  "description": {},
  "customModule": "",
  "typeRef": "emodel/type@type",
  "width": "extra-lg",
  "system": true,
  "i18n": {
    "ru": {
      "Enter the map \"key\" for this value.": "Введите \"ключ\" для соответствующего значения."
    },
    "en": {
      "Enter the map \"key\" for this value.": "Enter the map \"key\" for this value."
    }
  },
  "definition": {
    "components": [
      {
        "scrollableContent": true,
        "key": "panel3",
        "type": "panel",
        "components": [
          {
            "label": {
              "en": "Tabs"
            },
            "key": "tabs",
            "components": [
              {
                "label": {
                  "ru": "Основной",
                  "en": "Main"
                },
                "key": "main",
                "components": [
                  {
                    "columns": [
                      {
                        "components": [
                          {
                            "label": {
                              "ru": "Id"
                            },
                            "key": "moduleId",
                            "validate": {
                              "required": true
                            },
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true,
                            "logic": [
                              {
                                "name": "disabled",
                                "trigger": {
                                  "type": "javascript",
                                  "javascript": "result = _.get(instance, 'root.options.formMode') !== 'CREATE';"
                                },
                                "actions": [
                                  {
                                    "name": "setDisabled",
                                    "type": "property",
                                    "property": {
                                      "label": "Disabled",
                                      "value": "disabled",
                                      "type": "boolean"
                                    },
                                    "state": "true"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "label": {
                              "ru": "Родитель",
                              "en": "Parent"
                            },
                            "key": "_parentRefSelector",
                            "disableInlineEdit": true,
                            "clearOnHide": false,
                            "dataSrc": "custom",
                            "data": {
                              "custom": "values = [\n  {\n    label: utils.getTextByLocale({\n      en: 'Case',\n      ru: 'Кейс'\n    }),\n    value: 'emodel/type@case'\n  },  \n  {\n    label: utils.getTextByLocale({\n      en: 'Data List Item',\n      ru: 'Справочник'\n    }),\n    value: 'emodel/type@data-list'\n  },\n  {\n    label: utils.getTextByLocale({\n      en: 'Document',\n      ru: 'Документ'\n    }),\n    value: 'emodel/type@document'\n  },\n  {\n    label: utils.getTextByLocale({\n      en: 'Documents library file',\n      ru: 'Файл библиотеки документов'\n    }),\n    value: 'emodel/type@doclib-file'\n  },\n  {\n    label: utils.getTextByLocale({\n      en: 'Rest',\n      ru: 'Остальное'\n    }),\n    value: '__rest__'\n  },\n];"
                            },
                            "defaultValue": "",
                            "calculateValue": "const { parentRef, _parentRefJournal, _parentRefSelector } = data;\n\nif (_parentRefSelector === '__rest__') {\n  return;\n}\n\nif (!parentRef) {\n  value = 'emodel/type@case';\n} \n\nif (parentRef && ['emodel/type@data-list', 'emodel/type@case'].includes(parentRef)) {\n  value = parentRef;\n} else { \n  value = '__rest__';\n}",
                            "allowCalculateOverride": true,
                            "optionalWhenDisabled": false,
                            "properties": {
                              "value": "parentRef"
                            },
                            "customConditional": "const isView = _.get(instance, 'currentForm.options.formMode') === 'VIEW';\n\nshow = isView ? ['emodel/type@data-list', 'emodel/type@case'].includes(data.parentRef) : true;",
                            "type": "ecosSelect",
                            "input": true
                          },
                          {
                            "label": {
                              "en": "Parent",
                              "ru": "Родитель"
                            },
                            "key": "_parentRefJournal",
                            "validate": {
                              "required": true
                            },
                            "disableInlineEdit": true,
                            "persistent": false,
                            "mask": true,
                            "modalTitle": "",
                            "journalId": "ecos-types",
                            "queryData": "",
                            "refreshOn": [
                              "_parentRefSelector"
                            ],
                            "calculateValue": "const { parentRef, _parentRefSelector } = data;\n\nif (parentRef) {\n  value = parentRef;\n} ",
                            "allowCalculateOverride": true,
                            "optionalWhenDisabled": false,
                            "properties": {
                              "value": "parentRef"
                            },
                            "conditional": {
                              "show": "true",
                              "when": "_parentRefSelector",
                              "eq": "__rest__"
                            },
                            "logic": [
                              {
                                "name": "toggle label",
                                "trigger": {
                                  "type": "javascript",
                                  "javascript": "const isViewMode = _.get(instance, 'currentForm.options.formMode') === 'VIEW';\n\nresult = !isViewMode;"
                                },
                                "actions": [
                                  {
                                    "name": "hide label",
                                    "type": "property",
                                    "property": {
                                      "label": {
                                        "ru": "Скрыть надпись",
                                        "en": "Hide Label"
                                      },
                                      "value": "hideLabel",
                                      "type": "boolean"
                                    },
                                    "state": "true"
                                  }
                                ]
                              }
                            ],
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "parentRef"
                            },
                            "key": "parentRef",
                            "clearOnHide": false,
                            "refreshOn": [
                              "_parentRefSelector",
                              "_parentRefJournal"
                            ],
                            "customDefaultValue": "value = 'emodel/type@case';\n",
                            "calculateValue": "const { _parentRefSelector, _parentRefJournal, parentRef } = data;\n\nvalue = parentRef;\n\nif (_parentRefSelector) {\n  if (_parentRefSelector === '__rest__') {\n    if (_parentRefJournal) {\n      value = _parentRefJournal;\n    }\n  } else {\n    value = _parentRefSelector;\n  }\n}",
                            "triggerChangeWhenCalculate": true,
                            "optionalWhenDisabled": false,
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": "parentConfigFormRef",
                            "source": {
                              "type": "record",
                              "record": {
                                "id": "{{ data.parentRef }}",
                                "attributes": {
                                  "parentConfigFormRef": "configFormRef?str"
                                }
                              },
                              "forceLoad": false
                            },
                            "update": {
                              "type": "disabled"
                            },
                            "refreshOn": [
                              {
                                "label": "_parentRefSelector",
                                "value": "_parentRefSelector"
                              },
                              {
                                "label": "parentRef",
                                "value": "parentRef"
                              }
                            ],
                            "key": "asyncData",
                            "type": "asyncData",
                            "input": true
                          },
                          {
                            "hideLabel": true,
                            "columns": [
                              {
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Форма",
                                      "en": "Form"
                                    },
                                    "key": "formRef",
                                    "tooltip": {
                                      "ru": "Если вы желаете отредактировать форму по умолчанию, то создайте её копию.",
                                      "en": "If you want to edit default form, create a copy of it."
                                    },
                                    "hideEditRowButton": true,
                                    "modalTitle": "",
                                    "customActionRefs": [
                                      "uiserv/action@edit-form",
                                      "uiserv/action@debug-form",
                                      "uiserv/action@record-copy"
                                    ],
                                    "computed": {
                                      "valueDisplayName": "let recForDisp = value;\nif (value.id.indexOf('uiserv/form@type$') === 0) {\nrecForDisp = Citeck.Records.get('uiserv/form@DEFAULT_FORM');\n}\ndisp = recForDisp.load('?disp');\n"
                                    },
                                    "enableCreateButton": true,
                                    "journalId": "ecos-forms",
                                    "queryData": "",
                                    "defaultValue": "uiserv/form@DEFAULT_FORM",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "selectJournal",
                                    "input": true
                                  }
                                ],
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 0,
                                "md": 8
                              },
                              {
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 1,
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Наследовать форму",
                                      "en": "Inherit form"
                                    },
                                    "key": "inheritForm",
                                    "labelPosition": "top",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "checkbox",
                                    "input": true
                                  }
                                ],
                                "md": 4
                              }
                            ],
                            "key": "columns",
                            "type": "columns",
                            "input": false
                          },
                          {
                            "label": {
                              "ru": "Журнал",
                              "en": "Journal"
                            },
                            "key": "journalRef",
                            "tooltip": {
                              "ru": "Если вы желаете отредактировать журнал по умолчанию, то создайте его копию.",
                              "en": "If you want to edit default journal, then create a copy of it."
                            },
                            "hideEditRowButton": true,
                            "modalTitle": "",
                            "customActionRefs": [
                              "uiserv/action@edit",
                              "uiserv/action@record-copy"
                            ],
                            "enableCreateButton": true,
                            "journalId": "ecos-journals",
                            "queryData": "",
                            "computed": {
                              "valueDisplayName": "let recForDisp = value;\nif (value.id.indexOf('uiserv/journal@type$') === 0) {\nrecForDisp = Citeck.Records.get('uiserv/journal@DEFAULT_JOURNAL');\n}\ndisp = recForDisp.load('?disp');\n"
                            },
                            "defaultValue": "uiserv/journal@DEFAULT_JOURNAL",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Шаблон нумерации",
                              "en": "Number template"
                            },
                            "key": "numTemplateRef",
                            "modalTitle": "",
                            "journalId": "number-templates",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Наследовать шаблон нумерации",
                              "en": "Inherit number template"
                            },
                            "key": "inheritNumTemplate",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Форма дополнительной конфигурации типа",
                              "en": "Additional config form"
                            },
                            "key": "configFormRef",
                            "modalTitle": "",
                            "journalId": "ecos-forms",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Редактировать дополнительную конфигурацию",
                              "en": "Edit additional config"
                            },
                            "key": "editconfig",
                            "action": "custom",
                            "state": "",
                            "showValidations": false,
                            "custom": "var ownerId = Math.random().toString();\nvar currentRecord = Citeck.Records.get(instance.options.recordId);\n\nvar configFormRef = data.configFormRef;\nif (Array.isArray(configFormRef)) {\n    configFormRef = configFormRef[0];\n}\n\nif (!configFormRef && data.parentRef) {\n    configFormRef = Citeck.Records.get(data.parentRef).load('inhConfigFormRef?id', true);\n}\n\nPromise.all([configFormRef, currentRecord.load('config?json')])\n    .then(function(formAndConfig) {\n\n        var formRef = formAndConfig[0];\n        var config = formAndConfig[1];\n\n        if (formRef == null) {\n            throw new Error(\"Config form is not set\");\n        }\n\n        if (!config) {\n            config = {};\n        }\n\n        var configRecord = Citeck.Records.create(config, ownerId);\n\n        Citeck.forms.eform(configRecord.id, {\n            params: {\n                formId: formRef,\n                onSubmit: function (record) {\n                    var data = record.toJson().attributes;\n                    var resData = {};\n                    for (var key in data) {\n                        if (key[0] !== '_' && key !== 'pendingUpdate') {\n                            resData[key] = data[key];\n                        }\n                    }\n                    currentRecord.att(\"config?json\", resData);\n                    Citeck.Records.release(configRecord.id, ownerId);\n                },\n                onCancel: function () {\n                    Citeck.Records.release(configRecord.id, ownerId);\n                },\n                saveOnSubmit: false\n            },\n            class: 'ecos-modal_width-lg',\n            isBigHeader: true\n        });\n    })",
                            "block": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "customConditional": "show = !!data.asyncData['parentConfigFormRef'] || !!data['configFormRef'];",
                            "type": "button",
                            "input": true
                          }
                        ],
                        "type": "column",
                        "key": "column",
                        "index": 0,
                        "conditional": {
                          "show": null,
                          "when": null
                        },
                        "input": false
                      },
                      {
                        "index": 1,
                        "type": "column",
                        "key": "column",
                        "components": [
                          {
                            "label": {
                              "ru": "Имя",
                              "en": "Name"
                            },
                            "key": "name",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Шаблон отображения имени",
                              "en": "Display name template"
                            },
                            "key": "dispNameTemplate",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Описание",
                              "en": "Description"
                            },
                            "key": "description",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlTextarea",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Действия",
                              "en": "Actions"
                            },
                            "key": "actions",
                            "multiple": true,
                            "reorder": false,
                            "modalTitle": "",
                            "journalId": "ui-actions",
                            "defaultValue": [],
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Наследовать действия",
                              "en": "Inherit actions"
                            },
                            "key": "inheritActions",
                            "defaultValue": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Дополнительные свойства",
                              "en": "Additional properties"
                            },
                            "key": "properties",
                            "keyLabel": {
                              "ru": "Ключ",
                              "en": "Key"
                            },
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "datamap",
                            "valueComponent": {
                              "label": {
                                "ru": "Значение",
                                "en": "Value"
                              },
                              "key": "value",
                              "defaultValue": "Value",
                              "refreshOn": [],
                              "optionalWhenDisabled": false,
                              "type": "textfield",
                              "input": true
                            },
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Тип источника данных",
                              "en": "Source Type"
                            },
                            "key": "storageType",
                            "dataSrc": "values",
                            "data": {
                              "values": [
                                {
                                  "label": "ECOS Model",
                                  "value": "ECOS_MODEL"
                                },
                                {
                                  "label": "Alfresco",
                                  "value": "ALFRESCO"
                                },
                                {
                                  "label": "Default",
                                  "value": "DEFAULT"
                                }
                              ]
                            },
                            "optionalWhenDisabled": false,
                            "type": "ecosSelect",
                            "input": true,
                            "defaultValue": "ECOS_MODEL"
                          },
                          {
                            "label": {
                              "ru": "Видимость в рабочих пространствах",
                              "en": "Workspace visibility"
                            },
                            "key": "workspaceScope",
                            "dataSrc": "values",
                            "data": {
                              "values": [
                                {
                                  "label": {
                                    "en": "Default",
                                    "ru": "По умолчанию"
                                  },
                                  "value": "DEFAULT"
                                },
                                {
                                  "label": {
                                    "en": "Private",
                                    "ru": "Приватная"
                                  },
                                  "value": "PRIVATE"
                                },
                                {
                                  "label": {
                                    "en": "Public",
                                    "ru": "Публичная"
                                  },
                                  "value": "PUBLIC"
                                }
                              ],
                              "headers": [
                                {}
                              ]
                            },
                            "defaultValue": "DEFAULT",
                            "optionalWhenDisabled": false,
                            "type": "ecosSelect",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "ID источника данных",
                              "en": "Source ID"
                            },
                            "key": "sourceId",
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "customConditional": "show = data['storageType'] === 'ECOS_MODEL' || data['storageType'] === 'DEFAULT' || !data['storageType'];",
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Политика проверки прав при поиске",
                              "en": "Query permissions policy"
                            },
                            "key": "queryPermsPolicy",
                            "tooltip": {
                              "ru": "Данная политика позволяет настроить поиск с проверкой прав непосредственно записи, её родителя или вовсе отключить проверку прав при поиске. В любом режиме результат поиска дополнительно проверяется на наличие доступа.",
                              "en": "This policy allows you to configure the search to check permissions directly on the record, its parent, or completely disable permission checking during the search. In any mode, the search results are additionally checked for access."
                            },
                            "dataSrc": "values",
                            "data": {
                              "values": [
                                {
                                  "label": "Inherit from parent or data source",
                                  "value": "DEFAULT"
                                },
                                {
                                  "label": "Check own permissions",
                                  "value": "OWN"
                                },
                                {
                                  "label": "Check parent permissions",
                                  "value": "PARENT"
                                },
                                {
                                  "label": "Don't check permissions",
                                  "value": "PUBLIC"
                                },
                                {
                                  "label": "Query is disabled",
                                  "value": "NONE"
                                }
                              ],
                              "headers": [
                                {
                                  "key": "",
                                  "value": ""
                                }
                              ]
                            },
                            "defaultValue": "DEFAULT",
                            "optionalWhenDisabled": false,
                            "type": "ecosSelect",
                            "input": true
                          },
                          {
                            "label": {
                              "en": "Kanban board",
                              "ru": "Канбан доска"
                            },
                            "key": "boardRef",
                            "journalId": "ecos-boards",
                            "refreshOn": [],
                            "type": "selectJournal",
                            "input": true,
                            "queryData": ""
                          }
                        ],
                        "conditional": {
                          "show": null,
                          "when": null
                        },
                        "input": false
                      }
                    ],
                    "key": "columns4",
                    "type": "columns",
                    "tab": 0,
                    "input": false
                  }
                ]
              },
              {
                "label": {
                  "en": "Attributes",
                  "ru": "Атрибуты"
                },
                "key": "attributes",
                "components": [
                  {
                    "title": {
                      "ru": "Атрибуты",
                      "en": "Attributes"
                    },
                    "scrollableContent": true,
                    "collapsible": true,
                    "key": "panel8",
                    "type": "panel",
                    "input": false,
                    "components": [
                      {
                        "label": {
                          "en": "Attributes",
                          "ru": "Атрибуты"
                        },
                        "type": "datagrid",
                        "hideLabel": true,
                        "disableAddingRemovingRows": false,
                        "addAnother": "",
                        "addAnotherPosition": "bottom",
                        "removePlacement": "col",
                        "defaultOpen": false,
                        "layoutFixed": false,
                        "enableRowGroups": false,
                        "multiple": true,
                        "reorder": true,
                        "defaultValue": [
                          {
                            "id": "",
                            "name": {},
                            "type": "TEXT",
                            "submit": false,
                            "container": {
                              "submit7": false
                            },
                            "multiple": false,
                            "ecosSelect": "",
                            "select": "",
                            "mandatory": false
                          }
                        ],
                        "validate": {
                          "minLength": "",
                          "maxLength": ""
                        },
                        "key": "modelAttributes",
                        "input": true,
                        "components": [
                          {
                            "label": {
                              "ru": "Список атрибутов",
                              "en": "Attributes list"
                            },
                            "key": "columns5",
                            "columns": [
                              {
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Id",
                                      "en": "Id"
                                    },
                                    "key": "id",
                                    "validate": {
                                      "required": true,
                                      "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                                    },
                                    "type": "textfield",
                                    "input": true
                                  },
                                  {
                                    "label": {
                                      "ru": "Имя",
                                      "en": "Name"
                                    },
                                    "key": "name",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "mlText",
                                    "input": true,
                                    "row": "0-1"
                                  }
                                ],
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 0,
                                "md": 3
                              },
                              {
                                "index": 1,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Тип",
                                      "en": "Type"
                                    },
                                    "key": "type",
                                    "dataSrc": "values",
                                    "data": {
                                      "values": [
                                        {
                                          "label": "Text",
                                          "value": "TEXT"
                                        },
                                        {
                                          "label": "Options",
                                          "value": "OPTIONS"
                                        },
                                        {
                                          "label": "ML Text",
                                          "value": "MLTEXT"
                                        },
                                        {
                                          "label": "Person",
                                          "value": "PERSON"
                                        },
                                        {
                                          "label": "Group",
                                          "value": "AUTHORITY_GROUP"
                                        },
                                        {
                                          "label": "Authority",
                                          "value": "AUTHORITY"
                                        },
                                        {
                                          "label": "Association",
                                          "value": "ASSOC"
                                        },
                                        {
                                          "label": "Number",
                                          "value": "NUMBER"
                                        },
                                        {
                                          "label": "Boolean",
                                          "value": "BOOLEAN"
                                        },
                                        {
                                          "label": "Date",
                                          "value": "DATE"
                                        },
                                        {
                                          "label": "DateTime",
                                          "value": "DATETIME"
                                        },
                                        {
                                          "label": "Content",
                                          "value": "CONTENT"
                                        },
                                        {
                                          "label": "JSON",
                                          "value": "JSON"
                                        },
                                        {
                                          "label": "Binary",
                                          "value": "BINARY"
                                        }
                                      ]
                                    },
                                    "defaultValue": "TEXT",
                                    "optionalWhenDisabled": false,
                                    "type": "ecosSelect",
                                    "input": true,
                                    "row": "0-2"
                                  },
                                  {
                                    "label": {
                                      "ru": "Настроить",
                                      "en": "Setup"
                                    },
                                    "key": "submit6",
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "var currentRow = row;\nvar config = row.config || {}; \nvar formData = config;\n\nfunction checkForChanges(newData, originalData) {\n    const changed = {};\n    for (let key in newData) {\n        if (newData.hasOwnProperty(key) && originalData.hasOwnProperty(key)) {\n            if (newData[key] !== originalData[key]) {\n                changed[key] = {\n                    oldValue: originalData[key],\n                    newValue: newData[key]\n                };\n            }\n        }\n    }\n    return Object.keys(changed).length > 0 ? { \n      instance: changed, \n      component: { type: \"button\" }\n    } : null;\n}\n\n\nCiteck.EcosFormUtils.getFormById('uiserv/form@att-type-' + row.type + '-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    \n    var inputs = Citeck.EcosFormUtils.getFormInputs(formConfig.definition);\n\n    Citeck.Dialogs.showFormDialog({\n        title: 'Attribute type config',\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n            var configData = {};\n            for (let input of inputs) {\n                if (!input.scope) {\n                  configData[input.attribute] = data[input.attribute];\n                } else {\n                  let key = _.get(input, 'scope.component.key');\n                  if (key && !configData.hasOwnProperty(key)) {\n                    configData[key] = data[key];\n                  }\n                }\n            }\n            currentRow.config = configData;\n            const changedData = checkForChanges(data, formData);\n            submission.changed = changedData;\n            form.emit(\"change\", submission);\n        }\n    })\n    \n});",
                                    "block": true,
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "logic": [
                                      {
                                        "name": "check form",
                                        "trigger": {
                                          "type": "javascript",
                                          "javascript": "result = Citeck.EcosFormUtils.getFormById('uiserv/form@att-type-' + row.type + '-form', {\n    definition: 'definition?json'\n}).then(config => {\n  const isEmptyConfig = _.isEmpty(_.get(config, 'definition'));\n  \n  instance.showElement(!isEmptyConfig);\n  \n  return config;\n});\n"
                                        },
                                        "actions": [
                                          {
                                            "name": "test",
                                            "type": "property",
                                            "property": {
                                              "label": "Container Custom Class",
                                              "value": "customClass",
                                              "type": "string"
                                            },
                                            "text": "test-test-test"
                                          }
                                        ]
                                      }
                                    ],
                                    "type": "button",
                                    "input": true,
                                    "row": "0-3",
                                    "headers" : [ { } ]
                                  },
                                  {
                                    "label": {
                                      "ru": "Конфигурация",
                                      "en": "Config"
                                    },
                                    "key": "config",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "properties": {
                                      "dataType": "json"
                                    },
                                    "type": "hidden",
                                    "input": true
                                  }
                                ],
                                "md": 3
                              },
                              {
                                "index": 2,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Множественный",
                                      "en": "Multiple"
                                    },
                                    "key": "multiple",
                                    "type": "checkbox",
                                    "input": true,
                                    "row": "0-5"
                                  },
                                  {
                                    "label": {
                                      "ru": "Обязательный",
                                      "en": "Mandatory"
                                    },
                                    "key": "mandatory",
                                    "type": "checkbox",
                                    "input": true,
                                    "row": "0-5"
                                  }
                                ],
                                "md": 3
                              },
                              {
                                "index": 3,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "en": "Permissions",
                                      "ru": "Права доступа"
                                    },
                                    "key": "submit3",
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "var mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar customProps = {\n  roles: (data.modelRoles || []).map(mapToSingleLang),\n  statuses: (data.modelStatuses || []).map(mapToSingleLang),\n  attributeName: Citeck.helpers.getMLValue(row.name)\n};\n\nvar typeDispName = Citeck.helpers.getMLValue(data.name);\nif (typeDispName) {\n\tcustomProps.typeDispName = typeDispName;\n}\n\nCiteck.TypePermissionsService.editTypeAttPermissions(\n  typeRef, \n  row.id, \n  customProps\n)",
                                    "hideLabel": true,
                                    "leftIcon": "icon-decision-tables",
                                    "block": true,
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "button",
                                    "input": true,
                                    "row": "0-4"
                                  },
                                  {
                                    "label": {
                                      "en": " "
                                    },
                                    "key": "submit7",
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "var currentRow = row;\nvar computed = row.computed || {}; \nvar computedType = computed.type || 'NONE';\nvar formData = {\n    type: computedType,\n    storingType: computed.storingType || 'NONE'\n};\nformData[computedType + '_config'] = computed.config || {};\n\nfunction checkForChanges(newData, originalData) {\n    const changed = {};\n    for (let key in newData) {\n        if (newData.hasOwnProperty(key) && originalData.hasOwnProperty(key)) {\n            if (newData[key] !== originalData[key]) {\n                changed[key] = {\n                    oldValue: originalData[key],\n                    newValue: newData[key]\n                };\n            }\n        }\n    }\n    return Object.keys(changed).length > 0 ? { \n      instance: changed, \n      component: { type: \"button\" }\n    } : null;\n}\n\nCiteck.EcosFormUtils.getFormById('uiserv/form@computed-attribute-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    const lang = form && form.i18next && form.i18next.options ? form.i18next.options.lng : 'en';\n    let modalTitle = '';\n    if(lang === 'ru') { \n      modalTitle = 'Вычисляемые атрибуты'; \n    }\n    if(lang === 'en') {\n      modalTitle = 'Computed attribute';\n    }\n    \n    Citeck.Dialogs.showFormDialog({\n        title: modalTitle,\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n\n            currentRow.computed = {\n                type: data.type,\n                storingType: data.storingType,\n                config: data[data.type + '_config']\n            }\n            \n            const changedData = checkForChanges(data, formData);\n            submission.changed = changedData;\n            form.emit(\"change\", submission);\n        }\n    })\n    \n});",
                                    "removeIndents": true,
                                    "leftIcon": "icon-items",
                                    "block": true,
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "button",
                                    "input": true,
                                    "headers" : [ { } ]
                                  },
                                  {
                                    "label": {
                                      "ru": "Вычисляемый атрибут",
                                      "en": "Computed attribute"
                                    },
                                    "key": "computed",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "properties": {
                                      "dataType": "json"
                                    },
                                    "type": "hidden",
                                    "input": true
                                  }
                                ],
                                "md": 3
                              }
                            ],
                            "oneColumnInViewMode": false,
                            "type": "columns",
                            "input": false,
                            "row": "0-0"
                          }
                        ],
                        "tab": 3
                      }
                    ],
                    "collapsed": false,
                    "tab": 1
                  },
                  {
                    "label": {
                      "ru": "Панель",
                      "en": "Panel"
                    },
                    "key": "panel1234",
                    "title": {
                      "ru": "Наследуемые атрибуты",
                      "en": "Inherited Attributes"
                    },
                    "collapsible": true,
                    "collapsed": true,
                    "scrollableContent": true,
                    "refreshOn": [],
                    "optionalWhenDisabled": false,
                    "type": "panel",
                    "input": false,
                    "components": [
                      {
                        "label": "Inherited Attributes",
                        "hideLabel": true,
                        "disableAddingRemovingRows": true,
                        "addAnother": "",
                        "addAnotherPosition": "bottom",
                        "removePlacement": "col",
                        "defaultOpen": false,
                        "layoutFixed": false,
                        "enableRowGroups": false,
                        "multiple": true,
                        "reorder": false,
                        "defaultValue": [
                          {
                            "id2": "",
                            "id": "",
                            "name": "",
                            "submit3": false,
                            "submit4": false,
                            "type": "TEXT",
                            "submit": false,
                            "submit9": false,
                            "multiple": false,
                            "ecosSelect": "",
                            "select": "",
                            "multiple2": false,
                            "mandatory": false,
                            "textField": ""
                          }
                        ],
                        "validate": {
                          "minLength": "",
                          "maxLength": ""
                        },
                        "key": "parentModelAttributes",
                        "type": "datagrid",
                        "input": true,
                        "components": [
                          {
                            "label": {
                              "ru": "Список атрибутов",
                              "en": "Attributes list"
                            },
                            "columns": [
                              {
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Id"
                                    },
                                    "hideLabel": true,
                                    "disabled": true,
                                    "defaultValue": "",
                                    "validate": {
                                      "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                                    },
                                    "key": "id",
                                    "type": "textfield",
                                    "input": true
                                  }
                                ],
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 0,
                                "md": 4
                              },
                              {
                                "index": 1,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Имя",
                                      "en": "Name"
                                    },
                                    "hideLabel": true,
                                    "defaultValue": "",
                                    "key": "name",
                                    "type": "textfield",
                                    "input": true,
                                    "disabled": true
                                  }
                                ],
                                "md": 4
                              },
                              {
                                "index": 2,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "en": "Permissions"
                                    },
                                    "hideLabel": true,
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "\nvar mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar customProps = {\n  roles: (data.modelRoles || []).map(mapToSingleLang),\n  statuses: (data.modelStatuses || []).map(mapToSingleLang),\n  attributeName: Citeck.helpers.getMLValue(row.name)\n};\n\nvar typeDispName = Citeck.helpers.getMLValue(data.name);\nif (typeDispName) {\n\tcustomProps.typeDispName = typeDispName;\n}\n\nCiteck.TypePermissionsService.editTypeAttPermissions(\n  typeRef, \n  row.id, \n  customProps\n)",
                                    "leftIcon": "icon-decision-tables",
                                    "block": true,
                                    "key": "submit3",
                                    "customConditional": "show = _.get(data, 'ecosEdition.isEnterprise', false)",
                                    "type": "button",
                                    "input": true,
                                    "row": "0-4"
                                  }
                                ],
                                "md": 4
                              }
                            ],
                            "key": "columns5",
                            "type": "columns",
                            "input": false,
                            "row": "0-0"
                          }
                        ],
                        "tab": 3
                      }
                    ],
                    "tab": 1
                  },
                  {
                    "label": {
                      "ru": "Панель",
                      "en": "Panel"
                    },
                    "key": "panel9",
                    "title": {
                      "ru": "Настройка прав для тип данных",
                      "en": "Type Permissions"
                    },
                    "collapsible": true,
                    "collapsed": false,
                    "refreshOn": [],
                    "optionalWhenDisabled": false,
                    "type": "panel",
                    "input": false,
                    "components": [
                      {
                        "columns": [
                          {
                            "components": [
                              {
                                "label": {
                                  "ru": "Редактировать права",
                                  "en": "Edit permissions"
                                },
                                "key": "submit11",
                                "action": "custom",
                                "state": "",
                                "showValidations": false,
                                "custom": "var mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar customProps = {\n  roles: (data.modelRoles || []).map(mapToSingleLang),\n  statuses: (data.modelStatuses || []).map(mapToSingleLang)\n};\n\nvar typeDispName = Citeck.helpers.getMLValue(data.name);\nif (typeDispName) {\n\tcustomProps.typeDispName = typeDispName;\n}\n\nCiteck.TypePermissionsService.editTypePermissions(\n  typeRef,\n  customProps\n);",
                                "block": true,
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "button",
                                "input": true
                              }
                            ],
                            "md": 4,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 0
                          },
                          {
                            "md": 4,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 1,
                            "components": [
                              {
                                "label": {
                                  "ru": "Скачать матрицу прав",
                                  "en": "Download permissions"
                                },
                                "key": "submit11",
                                "action": "custom",
                                "state": "",
                                "showValidations": false,
                                "custom": "var mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar roles = (data.modelRoles || []).map(mapToSingleLang);\nvar statuses = (data.modelStatuses || []).map(mapToSingleLang);\nvar attributes = (data.modelAttributes || []).map(mapToSingleLang);\n\nCiteck.TypePermissionsService.downloadPermissionsConfig(typeRef, roles, statuses, attributes);",
                                "block": true,
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "button",
                                "input": true
                              }
                            ]
                          },
                          {
                            "md": 4,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 2,
                            "components": [
                              {
                                "label": {
                                  "ru": "Удалить матрицу прав",
                                  "en": "Delete permissions"
                                },
                                "key": "submit11",
                                "action": "custom",
                                "state": "",
                                "showValidations": false,
                                "custom": "var typeRef = 'emodel/type@' + data.moduleId;\nCiteck.TypePermissionsService.deletePermissionsConfig(typeRef);",
                                "block": true,
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "button",
                                "input": true
                              }
                            ]
                          }
                        ],
                        "key": "columns6",
                        "type": "columns",
                        "input": false
                      }
                    ],
                    "tab": 1
                  },
                  {
                    "label": "Attributes options",
                    "source": {
                      "type": "custom",
                      "custom": {
                        "syncData": "let currentAtts = (data.modelAttributes || []).filter(a => !!a.id).map(a => {\n  return {\n    value: a.id, \n    label: Citeck.helpers.getMLValue(a.name) || a.id\n  };\n});\nlet aspects = (data.aspects || []).filter(a => !!a.ref).map(a => a.ref);\n\nvalue = {\n  parent: data.parentRef,\n  aspects,\n  currentAtts\n};",
                        "asyncData": "let parentAttsPromise;\nif (data.parent) {\n    parentAttsPromise = Records.get(data.parent).load({\n        attributes: 'model.attributes[]{label:name,value:id}',\n        systemAtts: 'model.systemAttributes[]{label:name,value:id}'\n    });\n} else {\n    parentAttsPromise = Promise.resolve({});\n}\n\nlet aspectsAttsPromise;\nif (data.aspects) {\n    aspectsAttsPromise = Records.get(data.aspects).load({\n        prefix: 'prefix!id',\n        attributes: 'attributes[]{label:name._as.mltext,value:id}',\n        systemAtts: 'systemAttributes[]{label:name._as.mltext,value:id}'\n    }).then(aspectsAtts => {\n        const addPrefix = (prefix, atts) => {\n            let result = [];\n            for (let att of atts) {\n                result.push({\n                    label: att.label,\n                    value: prefix + ':' + att.value\n                });\n            }\n            return result;\n        }\n        const resultAspects = [];\n        for (let aspect of aspectsAtts) {\n            resultAspects.push({\n                attributes: addPrefix(aspect.prefix, aspect.attributes || []),\n                systemAttributes: addPrefix(aspect.prefix, aspect.systemAtts || [])\n            });\n        }\n        return resultAspects;\n    });\n} else {\n    aspectsAttsPromise = Promise.resolve([]);\n}\n\nvalue = Promise.all([parentAttsPromise, aspectsAttsPromise]).then(results => {\n\n    const parentAtts = results[0] || {};\n    const aspectsAtts = results[1] || [];\n\n    const attributes = {};\n    const systemAtts = {};\n    const fillAtts = (attsToFill, target) => {\n        if (!attsToFill || !attsToFill.length) {\n            return;\n        }\n        for (let att of attsToFill) {\n            if (att.value) {\n                let label = att.label\n                if (!label) {\n                    label = target[att.value] || att.value;\n                }\n                target[att.value] = label;\n            }\n        }\n    }\n    fillAtts(parentAtts.systemAtts, systemAtts);\n    fillAtts(parentAtts.attributes, attributes);\n\n    for (let aspectAtts of aspectsAtts) {\n        fillAtts(aspectAtts.systemAtts, systemAtts);\n        fillAtts(aspectAtts.attributes, attributes);\n    }\n\n    fillAtts(data.currentAtts, attributes);\n\n    const fullAtts = {};\n    for (let attId in systemAtts) {\n        fullAtts[attId] = systemAtts[attId];\n    }\n    for (let attId in attributes) {\n        fullAtts[attId] = attributes[attId];\n    }\n\n    const objToArray = (obj) => {\n        const resArr = [];\n        for (let value in obj) {\n            resArr.push({label: obj[value], value});\n        }\n        return resArr;    \n    }\n    \n    return {\n        attributes: objToArray(attributes),\n        systemAtts: objToArray(systemAtts),\n        fullAtts: objToArray(fullAtts)\n    }\n});"
                      }
                    },
                    "update": {
                      "type": "any-change",
                      "rate": 500
                    },
                    "refreshOn": [
                      {
                        "label": "parentRef",
                        "value": "parentRef"
                      }
                    ],
                    "key": "attributesOptions",
                    "type": "asyncData",
                    "input": true
                  }
                ]
              },
              {
                "label": {
                  "ru": "Аспекты",
                  "en": "Aspects"
                },
                "key": "aspects",
                "components": [
                  {
                    "label": {
                      "en": "Attributes",
                      "ru": "Аспекты"
                    },
                    "key": "aspects",
                    "hideLabel": true,
                    "multiple": true,
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "disableAddingRemovingRows": false,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "rowGroups": [
                      {
                        "label": "",
                        "numberOfRows": ""
                      }
                    ],
                    "reorder": true,
                    "defaultValue": [
                      {
                        "ref": ""
                      }
                    ],
                    "refreshOn": [],
                    "optionalWhenDisabled": false,
                    "type": "datagrid",
                    "input": true,
                    "components": [
                      {
                        "label": {
                          "ru": "Список аспектов",
                          "en": "Aspects list"
                        },
                        "key": "columns7",
                        "columns": [
                          {
                            "components": [
                              {
                                "label": {
                                  "ru": "Аспект",
                                  "en": "Aspect"
                                },
                                "key": "ref",
                                "hideEditRowButton": true,
                                "modalTitle": "",
                                "journalId": "ecos-aspects",
                                "queryData": "",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "selectJournal",
                                "input": true
                              }
                            ],
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 0,
                            "md": 3
                          },
                          {
                            "index": 1,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "components": [
                              {
                                "label": {
                                  "en": "Inherit aspect config",
                                  "ru": "Наследовать конфигурацию аспекта"
                                },
                                "key": "inheritConfig",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "checkbox",
                                "input": true
                              },
                              {
                                "label": {
                                  "ru": "Настроить",
                                  "en": "Edit"
                                },
                                "key": "submit4",
                                "action": "custom",
                                "state": "",
                                "showValidations": false,
                                "custom": "var currentRow = row;\r\nvar config = row.config || {};\r\nvar formData = config;\r\nvar aspectRef = row.ref;\r\n\r\nCiteck.Records\r\n  .get(aspectRef)\r\n  .load('configFormRef?id', true)\r\n  .then((formRef) => {\r\n    Citeck.EcosFormUtils.getFormById(formRef, {\r\n      definition: 'definition?json'\r\n    }).then(function(formConfig) {\r\n\r\n      var inputs = Citeck.EcosFormUtils.getFormInputs(formConfig.definition);\r\n\r\n      Citeck.Dialogs.showFormDialog({\r\n          title: 'Aspect type config',\r\n          showDefaultButtons: false,\r\n          formDefinition: formConfig.definition,\r\n          formData: formData,\r\n          onSubmit: submission => {\r\n              var data = submission.data || {};\r\n              var configData = {};\r\n              for (var i in inputs) {\r\n                  var att = inputs[i].attribute;\r\n                  configData[att] = data[att];\r\n              }\r\n\r\n              currentRow.config = configData;\r\n          }\r\n      })\r\n  });\r\n});",
                                "headers": [
                                  {
                                    "header": "",
                                    "value": ""
                                  }
                                ],
                                "block": true,
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "button",
                                "input": true
                              },
                              {
                                "label": {
                                  "ru": "Конфигурация",
                                  "en": "Config"
                                },
                                "key": "config",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "properties": {
                                  "dataType": "json"
                                },
                                "type": "hidden",
                                "input": true
                              }
                            ],
                            "md": 3
                          },
                          {
                            "index": 2,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "components": [],
                            "md": 3
                          },
                          {
                            "index": 3,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "components": [],
                            "md": 3
                          }
                        ],
                        "oneColumnInViewMode": false,
                        "type": "columns",
                        "input": false,
                        "row": "0-0"
                      }
                    ],
                    "tab": 2
                  }
                ]
              },
              {
                "label": {
                  "ru": "Роли",
                  "en": "Roles"
                },
                "key": "roles",
                "components": [
                  {
                    "label": "Roles",
                    "hideLabel": true,
                    "disableAddingRemovingRows": false,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "name": {},
                        "assignees": [],
                        "attributes": []
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "modelRoles",
                    "type": "datagrid",
                    "input": true,
                    "components": [
                      {
                        "label": {
                          "ru": "Id",
                          "en": "Id"
                        },
                        "key": "id",
                        "validate": {
                          "required": true,
                          "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                        },
                        "defaultValue": "",
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "textfield",
                        "input": true,
                        "row": "0-0"
                      },
                      {
                        "label": {
                          "ru": "Имя",
                          "en": "Name"
                        },
                        "key": "name",
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "mlText",
                        "input": true,
                        "row": "0-1"
                      },
                      {
                        "label": {
                          "ru": "Участники роли",
                          "en": "Assignees"
                        },
                        "key": "assignees",
                        "multiple": true,
                        "reorder": false,
                        "allowedGroupType": "ROLE, BRANCH, GROUP",
                        "rootGroupName": "",
                        "dataType": "authority",
                        "defaultValue": [],
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "selectOrgstruct",
                        "input": true,
                        "row": "0-2"
                      },
                      {
                        "label": {
                          "ru": "Атрибуты",
                          "en": "Attributes"
                        },
                        "multiple": true,
                        "key": "attributes",
                        "dataSrc": "custom",
                        "data": {
                          "custom": "values = (data['modelAttributes'] || []).filter(att => {\n  return !!att.id;\n}).map(function(att) {\n  return {\n    value: att.id,\n    label: Citeck.helpers.getMLValue(att.name)\n  };\n});\n\n"
                        },
                        "type": "ecosSelect",
                        "input": true,
                        "row": "0-3",
                        "defaultValue": "",
                        "reorder": false
                      },
                      {
                        "label": {
                          "ru": "Динамическая роль",
                          "en": "Dynamic role"
                        },
                        "key": "dynamic role",
                        "refreshOn": [],
                        "type": "panel",
                        "input": false,
                        "components": [
                          {
                            "label": {
                              "en": " "
                            },
                            "key": "submit9",
                            "action": "custom",
                            "state": "",
                            "showValidations": false,
                            "custom": "var currentRow = row;\nvar computed = row.computed || {}; \nvar computedType = computed.type || 'NONE';\nvar formData = {\n    type: computedType,\n    storingType: computed.storingType || 'NONE'\n};\nformData[computedType + '_config'] = computed.config || {};\n\n\nCiteck.EcosFormUtils.getFormById('uiserv/form@computed-role-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    const lang = form && form.i18next && form.i18next.options ? form.i18next.options.lng : 'en';\n    let modalTitle = '';\n    if(lang === 'ru') { \n      modalTitle = 'Вычисляемая роль'; \n    }\n    if(lang === 'en') {\n      modalTitle = 'Computed role';\n    }\n    Citeck.Dialogs.showFormDialog({\n        title: modalTitle,\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n\n            currentRow.computed = {\n                type: data.type,\n                storingType: data.storingType,\n                config: data[data.type + '_config']\n            }\n            \n            form.emit('change', {\n              changed: {\n              instance: currentRow,\n              component,\n            },\n             data: submission.data\n           });\n        }\n    })\n    \n});",
                            "headers": [
                              {
                                "header": "",
                                "value": ""
                              }
                            ],
                            "tooltip": {
                              "ru": "Настройка динамической роли",
                              "en": "Dynamic role config"
                            },
                            "removeIndents": true,
                            "leftIcon": "icon-items",
                            "block": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "button",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Настройка динамической роли",
                              "en": "Dynamic role config"
                            },
                            "key": "computed",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          }
                        ],
                        "row": "0-4"
                      }
                    ],
                    "tab": 3
                  }
                ]
              },
              {
                "label": {
                  "ru": "Статусы",
                  "en": "Statuses"
                },
                "key": "statuses",
                "components": [
                  {
                    "label": {
                      "ru": "Статус по умолчанию",
                      "en": "Default status"
                    },
                    "key": "defaultStatus",
                    "tooltip": {
                      "ru": "Если выбрано, то объект будет создан с выбранным статусом",
                      "en": "If selected, the object will be created with the selected status"
                    },
                    "dataSrc": "custom",
                    "data": {
                      "headers": [
                        {
                          "key": "",
                          "value": ""
                        }
                      ],
                      "custom": "values = (data['modelStatuses'] || []).filter(status => {\n    return !!status.id;\n}).map(function(att) {\n    return {\n        value: att.id,\n        label: Citeck.helpers.getMLValue(att.name)\n    };\n});\n\n"
                    },
                    "defaultValue": "",
                    "refreshOn": [
                      "modelStatuses"
                    ],
                    "optionalWhenDisabled": false,
                    "type": "ecosSelect",
                    "input": true
                  },
                  {
                    "label": {
                      "ru": "Статусы",
                      "en": "Statuses"
                    },
                    "key": "modelStatuses",
                    "multiple": true,
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "disableAddingRemovingRows": false,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "rowGroups": [
                      {
                        "label": "",
                        "numberOfRows": ""
                      }
                    ],
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "name": {}
                      }
                    ],
                    "refreshOn": [],
                    "optionalWhenDisabled": false,
                    "type": "datagrid",
                    "input": true,
                    "components": [
                      {
                        "label": {
                          "ru": "Id"
                        },
                        "key": "id",
                        "validate": {
                          "required": true,
                          "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                        },
                        "defaultValue": "",
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "textfield",
                        "input": true,
                        "row": "0-0"
                      },
                      {
                        "label": {
                          "ru": "Имя",
                          "en": "Name"
                        },
                        "key": "name",
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "mlText",
                        "input": true,
                        "row": "0-1"
                      }
                    ],
                    "tab": 4
                  }
                ]
              },
              {
                "label": {
                  "ru": "Стадии",
                  "en": "Stages"
                },
                "key": "stages",
                "components": [
                  {
                    "label": {
                      "ru": "Panel"
                    },
                    "key": "panel11",
                    "refreshOn": [
                      "ecosEdition"
                    ],
                    "optionalWhenDisabled": false,
                    "customConditional": "const isEnterprise = _.get(data, 'ecosEdition.isEnterprise', false);\nconst isWebform = _.get(instance, 'root.constructor.name') === 'Webform';\n\nshow = isWebform ? isEnterprise : true;",
                    "type": "panel",
                    "input": false,
                    "components": [
                      {
                        "label": {
                          "ru": "Информационное поле",
                          "en": "Info field"
                        },
                        "key": "isEmptyStatuses",
                        "hideLabel": true,
                        "tag": "div",
                        "className": "alert alert-info mt-4",
                        "attrs": [
                          {
                            "attr": "",
                            "value": ""
                          }
                        ],
                        "content": {
                          "ru": "Прежде, чем приступить к работе над стадиями, необходимо заполнить статусы",
                          "en": "Before you start working on the stages, you need to fill in the statuses"
                        },
                        "refreshOnChange": false,
                        "refreshOn": [
                          "modelStages.statuses"
                        ],
                        "optionalWhenDisabled": false,
                        "customConditional": "show = _.isEmpty(_.get(data, 'modelStatuses[0].id'));",
                        "type": "htmlelement",
                        "input": false,
                        "tab": 4
                      },
                      {
                        "label": {
                          "en": "Model Stages"
                        },
                        "key": "modelStages",
                        "hideLabel": true,
                        "multiple": true,
                        "validate": {
                          "minLength": "",
                          "maxLength": ""
                        },
                        "disableAddingRemovingRows": false,
                        "addAnotherPosition": "bottom",
                        "removePlacement": "col",
                        "defaultOpen": false,
                        "layoutFixed": true,
                        "enableRowGroups": false,
                        "reorder": true,
                        "tableView": false,
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "customConditional": "show = !_.isEmpty(_.get(data, 'modelStatuses[0].id'));",
                        "type": "datagrid",
                        "input": true,
                        "components": [
                          {
                            "label": {
                              "ru": "Название стадии",
                              "en": "Stage name"
                            },
                            "key": "name",
                            "validate": {
                              "custom": "let isNameFill = false;\n\n_.forIn(row.name, (value) => {\n  if (value) {\n    isNameFill = true;\n  }\n});\n\nif (!isNameFill && row.statuses.length) {\n  valid = false;\n} else {\n  valid = true;\n}"
                            },
                            "clearOnHide": false,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true,
                            "row": "0-0"
                          },
                          {
                            "label": {
                              "ru": "Статусы",
                              "en": "Statuses"
                            },
                            "key": "statuses",
                            "multiple": true,
                            "validate": {
                              "custom": "let isNameFill = false;\n\n_.forIn(row.name, (value) => {\n  if (value) {\n    isNameFill = true;\n  }\n});\n\nif (isNameFill && !row.statuses.length) {\n  valid = false;\n} else {\n  valid = true;\n}"
                            },
                            "reorder": false,
                            "dataSrc": "custom",
                            "data": {
                              "custom": "const { modelStatuses = [] } = data;\nconst statuses = [];\n\nmodelStatuses.forEach(item => {\n  const value = item.id;\n  const label = utils.getTextByLocale(item.name) || value;\n  \n  if (value) {\n    statuses.push({ label, value });\n  }\n});\n\nvalues = statuses;",
                              "headers": [
                                {}
                              ]
                            },
                            "unavailableItems": {
                              "isActive": true,
                              "code": "const { modelStages = [] } = data;\nconst result = modelStages.reduce((accum, item) => {\n  accum.push(..._.get(item, 'statuses', []));\n  \n  return accum;\n}, []);\n\nvalue = result;\n"
                            },
                            "defaultValue": [],
                            "optionalWhenDisabled": false,
                            "type": "ecosSelect",
                            "input": true,
                            "row": "0-1"
                          }
                        ],
                        "tab": 4
                      }
                    ],
                    "tab": 5
                  }
                ],
                "isNotAvailable": false,
                "ignored": false
              },
              {
                "label": {
                  "ru": "Варианты создания",
                  "en": "Create variants"
                },
                "key": "createVariants",
                "components": [
                  {
                    "label": {
                      "ru": "Columns"
                    },
                    "key": "columns3",
                    "columns": [
                      {
                        "components": [
                          {
                            "label": {
                              "en": "Default create variant",
                              "ru": "Вариант создания по умолчанию"
                            },
                            "key": "defaultCreateVariant",
                            "labelPosition": "top",
                            "hasThreeStates": true,
                            "defaultValue": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true,
                            "tab": 6
                          }
                        ],
                        "type": "column",
                        "input": false,
                        "key": "column",
                        "index": 0
                      },
                      {
                        "index": 1,
                        "type": "column",
                        "input": false,
                        "key": "column",
                        "components": [
                          {
                            "label": {
                              "ru": "Добавить варианты создания дочерних типов",
                              "en": "Add create variants for child types"
                            },
                            "key": "createVariantsForChildTypes",
                            "labelPosition": "top",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          }
                        ]
                      }
                    ],
                    "oneColumnInViewMode": false,
                    "type": "columns",
                    "input": false
                  },
                  {
                    "label": {
                      "ru": "Создать",
                      "en": "Create"
                    },
                    "hideLabel": true,
                    "disableAddingRemovingRows": false,
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "textField": "",
                        "container": {},
                        "attribute": "",
                        "name": {},
                        "target": "",
                        "direction": "TARGET",
                        "id2": "",
                        "attribute2": "",
                        "name3": {
                          "ru": "",
                          "en": ""
                        },
                        "recordRef": "",
                        "formRef": "",
                        "selectJournal": "",
                        "value": "Value",
                        "attributes": {},
                        "mlText": {
                          "ru": "",
                          "en": ""
                        },
                        "submit4": false,
                        "submit8": false,
                        "selectOrgstruct": "",
                        "allowedFor": [
                          "GROUP_company"
                        ]
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "createVariants",
                    "type": "datagrid",
                    "components": [
                      {
                        "key": "panel5",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Id",
                              "en": "Id"
                            },
                            "key": "id",
                            "validate": {
                              "required": true
                            },
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Имя",
                              "en": "Name"
                            },
                            "key": "name",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          }
                        ],
                        "row": "0-0",
                        "input": false
                      },
                      {
                        "key": "panel7",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Форма",
                              "en": "Form"
                            },
                            "key": "formRef",
                            "modalTitle": "",
                            "journalId": "ecos-forms",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true,
                            "queryData": ""
                          }
                        ],
                        "row": "0-1",
                        "input": false
                      },
                      {
                        "key": "panel6",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Разрешен для",
                              "en": "Allowed for"
                            },
                            "key": "allowedFor",
                            "multiple": true,
                            "reorder": true,
                            "clearOnHide": false,
                            "allowedGroupType": "ROLE, BRANCH, GROUP",
                            "dataType": "authority",
                            "defaultValue": [],
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectOrgstruct",
                            "input": true
                          }
                        ],
                        "row": "0-2",
                        "input": false
                      },
                      {
                        "key": "panel10",
                        "type": "panel",
                        "input": false,
                        "components": [
                          {
                            "label": {
                              "en": "Additional",
                              "ru": "Дополнительно"
                            },
                            "key": "submit8",
                            "action": "custom",
                            "state": "",
                            "showValidations": false,
                            "custom": "var currentRow = row;\nvar atts = [\n  ['attributes', {}], \n  ['formOptions', {}], \n  ['postActionRef', ''], \n  ['properties', {}],\n  ['sourceId', []]\n];\nvar formData = {};\nfor (var key of atts) {\n  formData[key[0]] = row[key[0]] || key[1];\n}\nCiteck.EcosFormUtils.getFormById('uiserv/form@create-variant-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    const lang = _.get(form, 'i18next.options.lng', 'en');\n    const title = {\n      ru: 'Вариант создания',\n      en: 'Create variant'\n    };\n    \n    Citeck.Dialogs.showFormDialog({\n        title,\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n\n      \t\t\tfor (var key of atts) {\n      \t\t\t  currentRow[key[0]] = data[key[0]] || key[1];\n      \t\t\t}\n        }\n    });\n    \n});",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "button",
                            "input": true,
                            "row": "0-3"
                          },
                          {
                            "label": {
                              "ru": "Атрибуты",
                              "en": "Attributes"
                            },
                            "key": "attributes",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Настройки формы",
                              "en": "Form options"
                            },
                            "key": "formOptions",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Свойства",
                              "en": "Properties"
                            },
                            "key": "properties",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Действие после создания",
                              "en": "Post creation action"
                            },
                            "key": "postActionRef",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "ID источника данных",
                              "en": "Source ID"
                            },
                            "key": "sourceId",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "hidden",
                            "input": true
                          }
                        ],
                        "row": "0-3"
                      }
                    ],
                    "tab": 6,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "input": true
                  }
                ]
              },
              {
                "label": {
                  "ru": "Связи",
                  "en": "Associations"
                },
                "key": "associations",
                "components": [
                  {
                    "label": "Associations",
                    "hideLabel": true,
                    "disableAddingRemovingRows": true,
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "textField": "",
                        "container": {},
                        "attribute": "",
                        "name": {},
                        "target": "",
                        "direction": "TARGET",
                        "mlText": {
                          "ru": "",
                          "en": ""
                        },
                        "selectJournal": "",
                        "journals": [],
                        "journalsFromTarget": false
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "associations",
                    "type": "datagrid",
                    "components": [
                      {
                        "key": "panel",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Id",
                              "en": "Id"
                            },
                            "key": "id",
                            "validate": {
                              "required": true
                            },
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Атрибут",
                              "en": "Attribute"
                            },
                            "key": "attribute",
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true
                          }
                        ],
                        "row": "0-0",
                        "input": false
                      },
                      {
                        "key": "panel2",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Имя",
                              "en": "Name"
                            },
                            "key": "name",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "label": {
                              "en": "Direction",
                              "ru": "Направление связи"
                            },
                            "key": "direction",
                            "dataSrc": "values",
                            "data": {
                              "values": [
                                {
                                  "label": "Target",
                                  "value": "TARGET"
                                },
                                {
                                  "label": "Source",
                                  "value": "SOURCE"
                                },
                                {
                                  "label": "Both",
                                  "value": "BOTH"
                                }
                              ]
                            },
                            "defaultValue": "TARGET",
                            "optionalWhenDisabled": false,
                            "type": "ecosSelect",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Загружать список журналов из целевого типа",
                              "en": "Load journals from target type"
                            },
                            "key": "journalsFromTarget",
                            "labelPosition": "top",
                            "hasThreeStates": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          }
                        ],
                        "row": "0-1",
                        "input": false
                      },
                      {
                        "key": "panel4",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Связанный тип",
                              "en": "Target type"
                            },
                            "key": "target",
                            "modalTitle": "",
                            "journalId": "ecos-types",
                            "queryData": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Журналы",
                              "en": "Journals"
                            },
                            "key": "journals",
                            "tooltip": {
                              "ru": "Журналы, которые можно использовать для создания новой ассоциации. Можно оставить пустым, чтобы журналы вычислились автоматически из target.",
                              "en": "Journals which can be used to select records to create association. May be empty to allow automatic journals calculation by target."
                            },
                            "multiple": true,
                            "reorder": false,
                            "modalTitle": "",
                            "journalId": "ecos-journals",
                            "queryData": "",
                            "defaultValue": [],
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          }
                        ],
                        "row": "0-2",
                        "input": false
                      }
                    ],
                    "tab": 7,
                    "input": true
                  }
                ]
              },
              {
                "label": {
                  "ru": "Конфигурация контента",
                  "en": "Content config"
                },
                "key": "contentConfigTab",
                "components": [
                  {
                    "label": {
                      "en": " "
                    },
                    "hideLabel": true,
                    "key": "contentConfig",
                    "refreshOn": [],
                    "type": "container",
                    "input": true,
                    "components": [
                      {
                        "label": {
                          "en": "Columns"
                        },
                        "hideLabel": true,
                        "key": "columns8",
                        "columns": [
                          {
                            "components": [
                              {
                                "label": {
                                  "en": "Attribute with main content",
                                  "ru": "Атрибут с основным контентом"
                                },
                                "key": "path",
                                "tooltip": {
                                  "ru": "По умолчанию \"content\"",
                                  "en": "By default \"content\""
                                },
                                "clearOnHide": false,
                                "defaultValue": "",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "textfield",
                                "input": true
                              },
                              {
                                "label": {
                                  "ru": "Атрибут с контентом для предпросмотра",
                                  "en": "Attribute with content for Preview"
                                },
                                "key": "previewPath",
                                "tooltip": {
                                  "ru": "По умолчанию равен атрибуту с основным контентом ",
                                  "en": "By default will be equal to attribute with main content"
                                },
                                "clearOnHide": false,
                                "defaultValue": "",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "textfield",
                                "input": true
                              }
                            ],
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 0
                          },
                          {
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 1,
                            "components": [
                              {
                                "label": {
                                  "ru": "Хранилище",
                                  "en": "Storage"
                                },
                                "key": "storageRef",
                                "modalTitle": "",
                                "journalId": "content-storages",
                                "source": {
                                  "type": "journal",
                                  "custom": {
                                    "columns": []
                                  }
                                },
                                "queryData": "",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "selectJournal",
                                "input": true
                              }
                            ]
                          }
                        ],
                        "type": "columns",
                        "input": false,
                        "tab": 6
                      }
                    ],
                    "tab": 8
                  }
                ]
              }
            ],
            "type": "tabs",
            "input": false
          }
        ],
        "input": false
      },
      {
        "columns": [
          {
            "type": "column",
            "md": 3,
            "index": 0,
            "components": [
              {
                "label": {
                  "ru": "Отменить",
                  "en": "Cancel"
                },
                "key": "submit2",
                "action": "event",
                "state": "",
                "showValidations": false,
                "event": "cancel",
                "block": true,
                "refreshOn": [],
                "optionalWhenDisabled": false,
                "type": "button",
                "input": true
              }
            ],
            "key": "column",
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false
          },
          {
            "type": "column",
            "index": 1,
            "components": [],
            "key": "column",
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false,
            "md": 3
          },
          {
            "components": [],
            "type": "column",
            "md": 3,
            "key": "column",
            "index": 2,
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false
          },
          {
            "md": 3,
            "type": "column",
            "input": false,
            "key": "column",
            "index": 3,
            "components": [
              {
                "label": {
                  "ru": "Сохранить",
                  "en": "Submit"
                },
                "key": "submit",
                "state": "",
                "theme": "primary",
                "block": true,
                "disableOnInvalid": true,
                "refreshOn": [],
                "optionalWhenDisabled": false,
                "type": "button",
                "input": true
              }
            ]
          }
        ],
        "key": "columns2",
        "type": "columns",
        "input": false
      }
    ],
    "display": "form",
    "formId": "ecos-type"
  },
  "attributes": {},
  "notExists": false
}
