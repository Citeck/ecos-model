{
  "id": "ecos-type",
  "system": true,
  "formKey": "",
  "title": {
    "en": "Type form"
  },
  "description": {},
  "customModule": null,
  "typeRef": "emodel/type@type",
  "width": "extra-lg",
  "i18n": {},
  "definition": {
    "components": [
      {
        "scrollableContent": true,
        "key": "panel3",
        "type": "panel",
        "components": [
          {
            "label": {
              "en": "Tabs"
            },
            "key": "tabs",
            "components": [
              {
                "label": {
                  "ru": "Основной",
                  "en": "Main"
                },
                "key": "main",
                "components": [
                  {
                    "columns": [
                      {
                        "components": [
                          {
                            "label": {
                              "ru": "Id"
                            },
                            "key": "moduleId",
                            "validate": {
                              "required": true
                            },
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Родитель",
                              "en": "Parent"
                            },
                            "key": "parentRef",
                            "modalTitle": "",
                            "journalId": "ecos-types",
                            "defaultValue": "emodel/type@case",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "hideLabel": true,
                            "columns": [
                              {
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Форма",
                                      "en": "Form"
                                    },
                                    "key": "formRef",
                                    "modalTitle": "",
                                    "journalId": "ecos-forms",
                                    "defaultValue": "uiserv/form@DEFAULT_FORM",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "selectJournal",
                                    "input": true,
                                    "queryData": ""
                                  }
                                ],
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 0,
                                "md": 8
                              },
                              {
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 1,
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Наследовать форму",
                                      "en": "Inherit form"
                                    },
                                    "key": "inheritForm",
                                    "labelPosition": "top",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "checkbox",
                                    "input": true
                                  }
                                ],
                                "md": 4
                              }
                            ],
                            "key": "columns",
                            "type": "columns",
                            "input": false
                          },
                          {
                            "label": {
                              "ru": "Журнал",
                              "en": "Journal"
                            },
                            "key": "journalRef",
                            "modalTitle": "",
                            "journalId": "ecos-journals",
                            "defaultValue": "uiserv/journal@DEFAULT_JOURNAL",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true,
                            "queryData": ""
                          },
                          {
                            "label": {
                              "ru": "Шаблон нумерации",
                              "en": "Number template"
                            },
                            "key": "numTemplateRef",
                            "modalTitle": "",
                            "journalId": "number-templates",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Наследовать шаблон нумерации",
                              "en": "Inherit number template"
                            },
                            "key": "inheritNumTemplate",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Форма дополнительной конфигурации типа",
                              "en": "Additional config form"
                            },
                            "key": "configFormRef",
                            "modalTitle": "",
                            "journalId": "ecos-forms",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Редактировать дополнительную конфигурацию",
                              "en": "Edit additional config"
                            },
                            "key": "editconfig",
                            "action": "custom",
                            "state": "",
                            "showValidations": false,
                            "custom": "var ownerId = Math.random().toString();\nvar currentRecord = Citeck.Records.get(instance.options.recordId);\n\nvar configFormRef = data.configFormRef;\nif (Array.isArray(configFormRef)) {\n    configFormRef = configFormRef[0];\n}\n\nif (!configFormRef && data.parentRef) {\n    configFormRef = Citeck.Records.get(data.parentRef).load('inhConfigFormRef?id', true);\n}\n\nPromise.all([configFormRef, currentRecord.load('config?json')])\n    .then(function(formAndConfig) {\n\n        var formRef = formAndConfig[0];\n        var config = formAndConfig[1];\n\n        if (formRef == null) {\n            throw new Error(\"Config form is not set\");\n        }\n\n        if (!config) {\n            config = {};\n        }\n\n        var configRecord = Citeck.Records.create(config, ownerId);\n\n        Citeck.forms.eform(configRecord.id, {\n            params: {\n                formId: formRef,\n                onSubmit: function (record) {\n                    var data = record.toJson().attributes;\n                    var resData = {};\n                    for (var key in data) {\n                        if (key[0] !== '_' && key !== 'pendingUpdate') {\n                            resData[key] = data[key];\n                        }\n                    }\n                    currentRecord.att(\"config?json\", resData);\n                    Citeck.Records.release(configRecord.id, ownerId);\n                },\n                onCancel: function () {\n                    Citeck.Records.release(configRecord.id, ownerId);\n                },\n                saveOnSubmit: false\n            },\n            class: 'ecos-modal_width-lg',\n            isBigHeader: true\n        });\n    })",
                            "block": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "customConditional": "show = !!data['configFormRef'];",
                            "type": "button",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Отображать библиотеку документов",
                              "en": "Show documents library"
                            },
                            "key": "docLibEnabled2",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          }
                        ],
                        "type": "column",
                        "key": "column",
                        "index": 0,
                        "conditional": {
                          "show": null,
                          "when": null
                        },
                        "input": false
                      },
                      {
                        "index": 1,
                        "type": "column",
                        "key": "column",
                        "components": [
                          {
                            "label": {
                              "ru": "Имя",
                              "en": "Name"
                            },
                            "key": "name",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Шаблон отображения имени",
                              "en": "Display name template"
                            },
                            "key": "dispNameTemplate",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Описание",
                              "en": "Description"
                            },
                            "key": "description",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlTextarea",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Действия",
                              "en": "Actions"
                            },
                            "key": "actions",
                            "multiple": true,
                            "reorder": false,
                            "modalTitle": "",
                            "journalId": "ui-actions",
                            "defaultValue": [],
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Наследовать действия",
                              "en": "Inherit actions"
                            },
                            "key": "inheritActions",
                            "defaultValue": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Дополнительные свойства",
                              "en": "Additional properties"
                            },
                            "key": "properties",
                            "keyLabel": "Ключ",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "datamap",
                            "valueComponent": {
                              "label": {
                                "ru": "Значение",
                                "en": "Value"
                              },
                              "key": "value",
                              "defaultValue": "Value",
                              "refreshOn": [],
                              "optionalWhenDisabled": false,
                              "type": "textfield",
                              "input": true
                            },
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Тип источника данных",
                              "en": "Source Type"
                            },
                            "key": "storageType",
                            "dataSrc": "values",
                            "data": {
                              "values": [
                                {
                                  "label": "ECOS Model",
                                  "value": "ECOS_MODEL"
                                },
                                {
                                  "label": "Alfresco",
                                  "value": "ALFRESCO"
                                },
                                {
                                  "label": "Default",
                                  "value": "DEFAULT"
                                }
                              ]
                            },
                            "optionalWhenDisabled": false,
                            "type": "ecosSelect",
                            "input": true,
                            "defaultValue": "ECOS_MODEL"
                          },
                          {
                            "label": {
                              "ru": "ID источника данных",
                              "en": "Source ID"
                            },
                            "key": "sourceId",
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "customConditional": "show = data['storageType'] === 'ECOS_MODEL' || data['storageType'] === 'DEFAULT' || !data['storageType'];",
                            "logic": [],
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": {
                              "en": "Kanban board",
                              "ru": "Канбан доска"
                            },
                            "key": "boardRef",
                            "journalId": "ecos-boards",
                            "refreshOn": [],
                            "type": "selectJournal",
                            "input": true,
                            "queryData": ""
                          }
                        ],
                        "conditional": {
                          "show": null,
                          "when": null
                        },
                        "input": false
                      }
                    ],
                    "key": "columns4",
                    "type": "columns",
                    "tab": 0,
                    "input": false
                  }
                ]
              },
              {
                "label": {
                  "en": "Attributes",
                  "ru": "Атрибуты"
                },
                "key": "attributes",
                "components": [
                  {
                    "title": {
                      "ru": "Атрибуты",
                      "en": "Attributes"
                    },
                    "scrollableContent": true,
                    "collapsible": true,
                    "key": "panel8",
                    "type": "panel",
                    "input": false,
                    "components": [
                      {
                        "label": {
                          "en": "Attributes",
                          "ru": "Атрибуты"
                        },
                        "type": "datagrid",
                        "hideLabel": true,
                        "disableAddingRemovingRows": false,
                        "addAnother": "",
                        "addAnotherPosition": "bottom",
                        "removePlacement": "col",
                        "defaultOpen": false,
                        "layoutFixed": false,
                        "enableRowGroups": false,
                        "multiple": true,
                        "reorder": true,
                        "defaultValue": [
                          {
                            "id2": "",
                            "id": "",
                            "name2": {},
                            "name": {},
                            "submit3": false,
                            "submit4": false,
                            "type": "TEXT",
                            "submit": false,
                            "submit6": false,
                            "submit7": false,
                            "submit8": false,
                            "container": {
                              "submit7": false
                            },
                            "submit9": false,
                            "multiple": false,
                            "ecosSelect": "",
                            "select": "",
                            "multiple2": false,
                            "mandatory": false
                          }
                        ],
                        "validate": {
                          "minLength": "",
                          "maxLength": ""
                        },
                        "key": "modelAttributes",
                        "input": true,
                        "components": [
                          {
                            "label": {
                              "ru": "Список атрибутов",
                              "en": "Attributes list"
                            },
                            "columns": [
                              {
                                "components": [
                                  {
                                    "label": "Id",
                                    "defaultValue": "",
                                    "validate": {
                                      "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                                    },
                                    "key": "id",
                                    "type": "textfield",
                                    "input": true
                                  }
                                ],
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 0,
                                "md": 2
                              },
                              {
                                "index": 1,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Имя",
                                      "en": "Name"
                                    },
                                    "key": "name",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "mlText",
                                    "input": true,
                                    "row": "0-1"
                                  }
                                ],
                                "md": 3
                              },
                              {
                                "index": 2,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Тип            ",
                                      "en": "Type"
                                    },
                                    "key": "type",
                                    "dataSrc": "values",
                                    "data": {
                                      "values": [
                                        {
                                          "label": "Text",
                                          "value": "TEXT"
                                        },
                                        {
                                          "label": "ML Text",
                                          "value": "MLTEXT"
                                        },
                                        {
                                          "label": "Person",
                                          "value": "PERSON"
                                        },
                                        {
                                          "label": "Group",
                                          "value": "AUTHORITY_GROUP"
                                        },
                                        {
                                          "label": "Authority",
                                          "value": "AUTHORITY"
                                        },
                                        {
                                          "label": "Association",
                                          "value": "ASSOC"
                                        },
                                        {
                                          "label": "Number",
                                          "value": "NUMBER"
                                        },
                                        {
                                          "label": "Boolean",
                                          "value": "BOOLEAN"
                                        },
                                        {
                                          "label": "Date",
                                          "value": "DATE"
                                        },
                                        {
                                          "label": "DateTime",
                                          "value": "DATETIME"
                                        },
                                        {
                                          "label": "Content",
                                          "value": "CONTENT"
                                        },
                                        {
                                          "label": "JSON",
                                          "value": "JSON"
                                        },
                                        {
                                          "label": "Binary",
                                          "value": "BINARY"
                                        }
                                      ]
                                    },
                                    "defaultValue": "TEXT",
                                    "optionalWhenDisabled": false,
                                    "type": "ecosSelect",
                                    "input": true,
                                    "row": "0-2"
                                  },
                                  {
                                    "label": {
                                      "ru": "Настроить",
                                      "en": "Setup"
                                    },
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "var currentRow = row;\nvar config = row.config || {}; \nvar formData = config;\n\nCiteck.EcosFormUtils.getFormById('uiserv/form@att-type-' + row.type + '-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    \n    var inputs = Citeck.EcosFormUtils.getFormInputs(formConfig.definition);\n\n    Citeck.Dialogs.showFormDialog({\n        title: 'Attribute type config',\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n            var configData = {};\n            for (var i in inputs) {\n                var att = inputs[i].attribute;\n                configData[att] = data[att];\n            }\n            currentRow.config = configData;\n        }\n    })\n    \n});",
                                    "block": true,
                                    "key": "submit6",
                                    "type": "button",
                                    "input": true,
                                    "row": "0-3"
                                  },
                                  {
                                    "label": {
                                      "ru": "Конфигурация",
                                      "en": "Config"
                                    },
                                    "key": "config",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "properties": {
                                      "dataType": "json"
                                    },
                                    "type": "hidden",
                                    "input": true
                                  }
                                ],
                                "md": 2
                              },
                              {
                                "index": 3,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Множественный",
                                      "en": "Multiple"
                                    },
                                    "key": "multiple",
                                    "type": "checkbox",
                                    "input": true,
                                    "row": "0-5"
                                  },
                                  {
                                    "label": {
                                      "ru": "Обязательный",
                                      "en": "Mandatory"
                                    },
                                    "key": "mandatory",
                                    "type": "checkbox",
                                    "input": true,
                                    "row": "0-5"
                                  }
                                ],
                                "md": 3
                              },
                              {
                                "index": 4,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "en": "Permissions"
                                    },
                                    "hideLabel": true,
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "\nvar mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar customProps = {\n  roles: (data.modelRoles || []).map(mapToSingleLang),\n  statuses: (data.modelStatuses || []).map(mapToSingleLang),\n  attributeName: Citeck.helpers.getMLValue(row.name)\n};\n\nvar typeDispName = Citeck.helpers.getMLValue(data.name);\nif (typeDispName) {\n\tcustomProps.typeDispName = typeDispName;\n}\n\nCiteck.TypePermissionsService.editTypeAttPermissions(\n  typeRef, \n  row.id, \n  customProps\n)",
                                    "leftIcon": "icon-decision-tables",
                                    "block": true,
                                    "key": "submit3",
                                    "customConditional": "show = _.get(data, 'ecosEdition.edition') === 'enterprise'",
                                    "type": "button",
                                    "input": true,
                                    "row": "0-4"
                                  },
                                  {
                                    "label": {
                                      "en": " "
                                    },
                                    "key": "submit7",
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "var currentRow = row;\nvar computed = row.computed || {}; \nvar computedType = computed.type || 'NONE';\nvar formData = {\n    type: computedType,\n    storingType: computed.storingType || 'NONE'\n};\nformData[computedType + '_config'] = computed.config || {};\n\n\nCiteck.EcosFormUtils.getFormById('uiserv/form@computed-attribute-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    const lang = form && form.i18next && form.i18next.options ? form.i18next.options.lng : 'en';\n    let modalTitle = '';\n    if(lang === 'ru') { \n      modalTitle = 'Вычисляемые атрибуты'; \n    }\n    if(lang === 'en') {\n      modalTitle = 'Computed attribute';\n    }\n    \n    Citeck.Dialogs.showFormDialog({\n        title: modalTitle,\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n\n            currentRow.computed = {\n                type: data.type,\n                storingType: data.storingType,\n                config: data[data.type + '_config']\n            }\n        }\n    })\n    \n});",
                                    "removeIndents": true,
                                    "leftIcon": "icon-items",
                                    "block": true,
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "type": "button",
                                    "input": true
                                  },
                                  {
                                    "label": {
                                      "ru": "Вычисляемый атрибут",
                                      "en": "Computed attribute"
                                    },
                                    "key": "computed",
                                    "refreshOn": [],
                                    "optionalWhenDisabled": false,
                                    "properties": {
                                      "dataType": "json"
                                    },
                                    "type": "hidden",
                                    "input": true
                                  }
                                ],
                                "md": 2
                              }
                            ],
                            "key": "columns5",
                            "type": "columns",
                            "input": false,
                            "row": "0-0"
                          }
                        ],
                        "tab": 3
                      }
                    ],
                    "collapsed": false,
                    "tab": 1
                  },
                  {
                    "label": {
                      "ru": "Панель",
                      "en": "Panel"
                    },
                    "key": "panel1234",
                    "title": {
                      "ru": "Наследуемые атрибуты",
                      "en": "Inherited Attributes"
                    },
                    "collapsible": true,
                    "collapsed": true,
                    "scrollableContent": true,
                    "refreshOn": [],
                    "optionalWhenDisabled": false,
                    "type": "panel",
                    "input": false,
                    "components": [
                      {
                        "label": "Inherited Attributes",
                        "hideLabel": true,
                        "disableAddingRemovingRows": true,
                        "addAnother": "",
                        "addAnotherPosition": "bottom",
                        "removePlacement": "col",
                        "defaultOpen": false,
                        "layoutFixed": false,
                        "enableRowGroups": false,
                        "multiple": true,
                        "reorder": false,
                        "defaultValue": [
                          {
                            "id2": "",
                            "id": "",
                            "name": "",
                            "submit3": false,
                            "submit4": false,
                            "type": "TEXT",
                            "submit": false,
                            "submit9": false,
                            "multiple": false,
                            "ecosSelect": "",
                            "select": "",
                            "multiple2": false,
                            "mandatory": false,
                            "textField": ""
                          }
                        ],
                        "validate": {
                          "minLength": "",
                          "maxLength": ""
                        },
                        "key": "parentModelAttributes",
                        "type": "datagrid",
                        "input": true,
                        "components": [
                          {
                            "label": {
                              "ru": "Список атрибутов",
                              "en": "Attributes list"
                            },
                            "columns": [
                              {
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Id"
                                    },
                                    "hideLabel": true,
                                    "disabled": true,
                                    "defaultValue": "",
                                    "validate": {
                                      "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                                    },
                                    "key": "id",
                                    "type": "textfield",
                                    "input": true
                                  }
                                ],
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 0,
                                "md": 4
                              },
                              {
                                "index": 1,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "ru": "Имя",
                                      "en": "Name"
                                    },
                                    "hideLabel": true,
                                    "defaultValue": "",
                                    "key": "name",
                                    "type": "textfield",
                                    "input": true,
                                    "disabled": true
                                  }
                                ],
                                "md": 4
                              },
                              {
                                "index": 2,
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "components": [
                                  {
                                    "label": {
                                      "en": "Permissions"
                                    },
                                    "hideLabel": true,
                                    "action": "custom",
                                    "state": "",
                                    "showValidations": false,
                                    "custom": "\nvar mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar customProps = {\n  roles: (data.modelRoles || []).map(mapToSingleLang),\n  statuses: (data.modelStatuses || []).map(mapToSingleLang),\n  attributeName: Citeck.helpers.getMLValue(row.name)\n};\n\nvar typeDispName = Citeck.helpers.getMLValue(data.name);\nif (typeDispName) {\n\tcustomProps.typeDispName = typeDispName;\n}\n\nCiteck.TypePermissionsService.editTypeAttPermissions(\n  typeRef, \n  row.id, \n  customProps\n)",
                                    "leftIcon": "icon-decision-tables",
                                    "block": true,
                                    "key": "submit3",
                                    "customConditional": "show = _.get(data, 'ecosEdition.edition') === 'enterprise'",
                                    "type": "button",
                                    "input": true,
                                    "row": "0-4"
                                  }
                                ],
                                "md": 4
                              }
                            ],
                            "key": "columns5",
                            "type": "columns",
                            "input": false,
                            "row": "0-0"
                          }
                        ],
                        "tab": 3
                      }
                    ],
                    "tab": 1
                  },
                  {
                    "label": {
                      "ru": "Панель",
                      "en": "Panel"
                    },
                    "title": {
                      "ru": "Настройка прав для тип данных",
                      "en": "Type Permissions"
                    },
                    "collapsible": true,
                    "collapsed": false,
                    "key": "panel9",
                    "customConditional": "show = _.get(data, 'ecosEdition.edition') === 'enterprise'",
                    "type": "panel",
                    "input": false,
                    "components": [
                      {
                        "columns": [
                          {
                            "components": [
                              {
                                "label": {
                                  "ru": "Редактировать права",
                                  "en": "Edit permissions"
                                },
                                "key": "submit11",
                                "action": "custom",
                                "state": "",
                                "showValidations": false,
                                "custom": "var mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar customProps = {\n  roles: (data.modelRoles || []).map(mapToSingleLang),\n  statuses: (data.modelStatuses || []).map(mapToSingleLang)\n};\n\nvar typeDispName = Citeck.helpers.getMLValue(data.name);\nif (typeDispName) {\n\tcustomProps.typeDispName = typeDispName;\n}\n\nCiteck.TypePermissionsService.editTypePermissions(\n  typeRef,\n  customProps\n);",
                                "block": true,
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "button",
                                "input": true
                              }
                            ],
                            "md": 4,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 0
                          },
                          {
                            "md": 4,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 1,
                            "components": [
                              {
                                "label": {
                                  "ru": "Скачать матрицу прав",
                                  "en": "Download permissions"
                                },
                                "key": "submit11",
                                "action": "custom",
                                "state": "",
                                "showValidations": false,
                                "custom": "var mapToSingleLang = function (value) {\n  return {\n    id: value.id,\n    name: Citeck.helpers.getMLValue(value.name)\n  };\n};\n\nvar typeRef = 'emodel/type@' + data.moduleId;\nvar roles = (data.modelRoles || []).map(mapToSingleLang);\nvar statuses = (data.modelStatuses || []).map(mapToSingleLang);\nvar attributes = (data.modelAttributes || []).map(mapToSingleLang);\n\nCiteck.TypePermissionsService.downloadPermissionsConfig(typeRef, roles, statuses, attributes);",
                                "block": true,
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "button",
                                "input": true
                              }
                            ]
                          },
                          {
                            "md": 4,
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 2,
                            "components": [
                              {
                                "label": {
                                  "ru": "Удалить матрицу прав",
                                  "en": "Delete permissions"
                                },
                                "key": "submit11",
                                "action": "custom",
                                "state": "",
                                "showValidations": false,
                                "custom": "var typeRef = 'emodel/type@' + data.moduleId;\nCiteck.TypePermissionsService.deletePermissionsConfig(typeRef);",
                                "block": true,
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "button",
                                "input": true
                              }
                            ]
                          }
                        ],
                        "key": "columns6",
                        "type": "columns",
                        "input": false
                      }
                    ],
                    "tab": 1
                  },
                  {
                    "label": "ecosEdition",
                    "source": {
                      "type": "record",
                      "record": {
                        "id": "alfresco/meta@",
                        "attributes": {
                          "edition": "attributes.edition"
                        }
                      },
                      "forceLoad": false
                    },
                    "update": {
                      "type": "once"
                    },
                    "key": "ecosEdition",
                    "type": "asyncData",
                    "input": true,
                    "tab": 1
                  }
                ]
              },
              {
                "label": {
                  "ru": "Роли",
                  "en": "Roles"
                },
                "key": "roles",
                "components": [
                  {
                    "label": "Roles",
                    "hideLabel": true,
                    "disableAddingRemovingRows": false,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id2": "",
                        "id": "",
                        "name2": {},
                        "name": {},
                        "submit3": false,
                        "submit4": false,
                        "assignees": [],
                        "attributes": [],
                        "submit9": false
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "modelRoles",
                    "type": "datagrid",
                    "input": true,
                    "components": [
                      {
                        "label": {
                          "ru": "Id",
                          "en": "Id"
                        },
                        "key": "id",
                        "validate": {
                          "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                        },
                        "defaultValue": "",
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "textfield",
                        "input": true,
                        "row": "0-0"
                      },
                      {
                        "label": {
                          "ru": "Имя",
                          "en": "Name"
                        },
                        "key": "name",
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "mlText",
                        "input": true,
                        "row": "0-1"
                      },
                      {
                        "label": {
                          "ru": "Участники роли",
                          "en": "Assignees"
                        },
                        "key": "assignees",
                        "multiple": true,
                        "reorder": false,
                        "allowedGroupType": "ROLE, BRANCH, GROUP",
                        "rootGroupName": "",
                        "dataType": "authority",
                        "defaultValue": [],
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "selectOrgstruct",
                        "input": true,
                        "row": "0-2"
                      },
                      {
                        "label": {
                          "ru": "Атрибуты",
                          "en": "Attributes"
                        },
                        "multiple": true,
                        "key": "attributes",
                        "dataSrc": "custom",
                        "data": {
                          "custom": "values = (data['modelAttributes'] || []).filter(att => {\n  return !!att.id;\n}).map(function(att) {\n  return {\n    value: att.id,\n    label: Citeck.helpers.getMLValue(att.name)\n  };\n});\n\n"
                        },
                        "type": "ecosSelect",
                        "input": true,
                        "row": "0-3",
                        "defaultValue": "",
                        "reorder": false
                      },
                      {
                        "label": {
                          "ru": "Динамическая роль",
                          "en": "Dynamic role"
                        },
                        "key": "dynamic role",
                        "refreshOn": [],
                        "type": "panel",
                        "input": false,
                        "components": [
                          {
                            "label": {
                              "en": " "
                            },
                            "key": "submit9",
                            "action": "custom",
                            "state": "",
                            "showValidations": false,
                            "custom": "var currentRow = row;\nvar computed = row.computed || {}; \nvar computedType = computed.type || 'NONE';\nvar formData = {\n    type: computedType,\n    storingType: computed.storingType || 'NONE'\n};\nformData[computedType + '_config'] = computed.config || {};\n\n\nCiteck.EcosFormUtils.getFormById('uiserv/form@computed-attribute-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    const lang = form && form.i18next && form.i18next.options ? form.i18next.options.lng : 'en';\n    let modalTitle = '';\n    if(lang === 'ru') { \n      modalTitle = 'Вычисляемые атрибуты'; \n    }\n    if(lang === 'en') {\n      modalTitle = 'Computed attribute';\n    }\n    Citeck.Dialogs.showFormDialog({\n        title: modalTitle,\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n\n            currentRow.computed = {\n                type: data.type,\n                storingType: data.storingType,\n                config: data[data.type + '_config']\n            }\n        }\n    })\n    \n});",
                            "tooltip": {
                              "ru": "Настройка динамической роли",
                              "en": "Dynamic role config"
                            },
                            "removeIndents": true,
                            "leftIcon": "icon-items",
                            "block": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "button",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Настройка динамической роли",
                              "en": "Dynamic role config"
                            },
                            "key": "computed",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          }
                        ],
                        "row": "0-4"
                      }
                    ],
                    "tab": 2
                  }
                ]
              },
              {
                "label": {
                  "ru": "Статусы",
                  "en": "Statuses"
                },
                "key": "statuses",
                "components": [
                  {
                    "label": "Statuses",
                    "hideLabel": true,
                    "disableAddingRemovingRows": false,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id2": "",
                        "id": "",
                        "name2": {},
                        "name": {},
                        "submit3": false,
                        "submit4": false,
                        "id3": "",
                        "name3": {},
                        "submit5": false
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "modelStatuses",
                    "type": "datagrid",
                    "input": true,
                    "components": [
                      {
                        "label": "Id",
                        "defaultValue": "",
                        "validate": {
                          "pattern": "(^$|[_a-zA-Z][_\\w-.:]*)"
                        },
                        "key": "id",
                        "type": "textfield",
                        "input": true,
                        "row": "0-0"
                      },
                      {
                        "label": {
                          "ru": "Имя",
                          "en": "Name"
                        },
                        "key": "name",
                        "refreshOn": [],
                        "optionalWhenDisabled": false,
                        "type": "mlText",
                        "input": true,
                        "row": "0-1"
                      }
                    ],
                    "tab": 5
                  }
                ]
              },
              {
                "label": {
                  "ru": "Варианты создания",
                  "en": "Create variants"
                },
                "key": "createVariants",
                "components": [
                  {
                    "label": {
                      "en": "Default create variant",
                      "ru": "Вариант создания по умолчанию"
                    },
                    "key": "defaultCreateVariant",
                    "labelPosition": "top",
                    "hasThreeStates": true,
                    "defaultValue": true,
                    "refreshOn": [],
                    "optionalWhenDisabled": false,
                    "type": "checkbox",
                    "input": true,
                    "tab": 4
                  },
                  {
                    "label": {
                      "ru": "Создать",
                      "en": "Create"
                    },
                    "hideLabel": true,
                    "disableAddingRemovingRows": false,
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "textField": "",
                        "container": {},
                        "attribute": "",
                        "name": {},
                        "target": "",
                        "direction": "TARGET",
                        "id2": "",
                        "attribute2": "",
                        "name3": {
                          "ru": "",
                          "en": ""
                        },
                        "recordRef": "",
                        "formRef": "",
                        "selectJournal": "",
                        "value": "Value",
                        "attributes": {},
                        "mlText": {
                          "ru": "",
                          "en": ""
                        },
                        "submit4": false,
                        "submit8": false,
                        "selectOrgstruct": "",
                        "allowedFor": [
                          "GROUP_company"
                        ]
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "createVariants",
                    "type": "datagrid",
                    "components": [
                      {
                        "key": "panel5",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Id",
                              "en": "Id"
                            },
                            "key": "id",
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Имя",
                              "en": "Name"
                            },
                            "key": "name",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          }
                        ],
                        "row": "0-0",
                        "input": false
                      },
                      {
                        "key": "panel7",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Форма",
                              "en": "Form"
                            },
                            "key": "formRef",
                            "modalTitle": "",
                            "journalId": "ecos-forms",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true,
                            "queryData": ""
                          }
                        ],
                        "row": "0-1",
                        "input": false
                      },
                      {
                        "key": "panel6",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Разрешен для",
                              "en": "Allowed for"
                            },
                            "key": "allowedFor",
                            "multiple": true,
                            "reorder": true,
                            "clearOnHide": false,
                            "allowedAuthorityType": "GROUP",
                            "dataType": "authority",
                            "defaultValue": [],
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectOrgstruct",
                            "input": true
                          }
                        ],
                        "row": "0-2",
                        "input": false
                      },
                      {
                        "key": "panel10",
                        "type": "panel",
                        "input": false,
                        "components": [
                          {
                            "label": {
                              "en": "Additional",
                              "ru": "Дополнительно"
                            },
                            "key": "submit8",
                            "action": "custom",
                            "state": "",
                            "showValidations": false,
                            "custom": "var currentRow = row;\nvar atts = [\n  ['attributes', {}], \n  ['formOptions', {}], \n  ['postActionRef', ''], \n  ['properties', {}],\n  ['sourceId', []]\n];\nvar formData = {};\nfor (var key of atts) {\n  formData[key[0]] = row[key[0]] || key[1];\n}\nCiteck.EcosFormUtils.getFormById('uiserv/form@create-variant-form', {\n    definition: 'definition?json'\n}).then(function(formConfig) {\n    const lang = form && form.i18next && form.i18next.options ? form.i18next.options.lng : 'en';\n    let modalTitle = '';\n    if(lang === 'ru') { \n      modalTitle = 'Вариант создания'; \n    }\n    if(lang === 'en') {\n      modalTitle = 'Create variant';\n    }\n    Citeck.Dialogs.showFormDialog({\n        title: modalTitle,\n        showDefaultButtons: true,\n        formDefinition: formConfig.definition,\n        formData: formData,\n        onSubmit: submission => {\n            var data = submission.data || {};\n\n\t\t\tfor (var key of atts) {\n\t\t\t  currentRow[key[0]] = data[key[0]] || key[1];\n\t\t\t}\n        }\n    })\n    \n});",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "button",
                            "input": true,
                            "row": "0-3"
                          },
                          {
                            "label": {
                              "ru": "Атрибуты",
                              "en": "Attributes"
                            },
                            "key": "attributes",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Настройки формы",
                              "en": "Form options"
                            },
                            "key": "formOptions",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Свойства",
                              "en": "Properties"
                            },
                            "key": "properties",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "properties": {
                              "dataType": "json"
                            },
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Действие после создания",
                              "en": "Post creation action"
                            },
                            "key": "postActionRef",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "hidden",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "ID источника данных",
                              "en": "Source ID"
                            },
                            "key": "sourceId",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "hidden",
                            "input": true
                          }
                        ],
                        "row": "0-3"
                      }
                    ],
                    "tab": 4,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "input": true
                  }
                ]
              },
              {
                "label": {
                  "ru": "Связи",
                  "en": "Associations"
                },
                "key": "associations",
                "components": [
                  {
                    "label": "Associations",
                    "hideLabel": true,
                    "disableAddingRemovingRows": true,
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "textField": "",
                        "container": {},
                        "attribute": "",
                        "name": {},
                        "target": "",
                        "direction": "TARGET",
                        "mlText": {
                          "ru": "",
                          "en": ""
                        },
                        "selectJournal": "",
                        "journals": [],
                        "journalsFromTarget": false
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "associations",
                    "type": "datagrid",
                    "components": [
                      {
                        "key": "panel",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Id",
                              "en": "Id"
                            },
                            "key": "id",
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Атрибут",
                              "en": "Attribute"
                            },
                            "key": "attribute",
                            "defaultValue": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "textfield",
                            "input": true
                          }
                        ],
                        "row": "0-0",
                        "input": false
                      },
                      {
                        "key": "panel2",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Имя",
                              "en": "Name"
                            },
                            "key": "name",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "label": {
                              "en": "Direction",
                              "ru": "Направление связи"
                            },
                            "key": "direction",
                            "dataSrc": "values",
                            "data": {
                              "values": [
                                {
                                  "label": "Target",
                                  "value": "TARGET"
                                },
                                {
                                  "label": "Source",
                                  "value": "SOURCE"
                                },
                                {
                                  "label": "Both",
                                  "value": "BOTH"
                                }
                              ]
                            },
                            "defaultValue": "TARGET",
                            "optionalWhenDisabled": false,
                            "type": "ecosSelect",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Загружать список журналов из целевого типа",
                              "en": "Load journals from target type"
                            },
                            "key": "journalsFromTarget",
                            "labelPosition": "top",
                            "hasThreeStates": true,
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "checkbox",
                            "input": true
                          }
                        ],
                        "row": "0-1",
                        "input": false
                      },
                      {
                        "key": "panel4",
                        "type": "panel",
                        "components": [
                          {
                            "label": {
                              "ru": "Связанный тип",
                              "en": "Target type"
                            },
                            "key": "target",
                            "modalTitle": "",
                            "journalId": "ecos-types",
                            "queryData": "",
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": {
                              "ru": "Журналы",
                              "en": "Journals"
                            },
                            "key": "journals",
                            "tooltip": {
                              "ru": "Журналы, которые можно использовать для создания новой ассоциации. Можно оставить пустым, чтобы журналы вычислились автоматически из target.",
                              "en": "Journals which can be used to select records to create association. May be empty to allow automatic journals calculation by target."
                            },
                            "multiple": true,
                            "reorder": false,
                            "modalTitle": "",
                            "journalId": "ecos-journals",
                            "queryData": "",
                            "defaultValue": [],
                            "refreshOn": [],
                            "optionalWhenDisabled": false,
                            "type": "selectJournal",
                            "input": true
                          }
                        ],
                        "row": "0-2",
                        "input": false
                      }
                    ],
                    "tab": 5,
                    "input": true
                  }
                ]
              },
              {
                "label": {
                  "ru": "Конфигурация контента",
                  "en": "Content config"
                },
                "key": "contentConfigTab",
                "components": [
                  {
                    "label": {
                      "en": " "
                    },
                    "hideLabel": true,
                    "key": "contentConfig",
                    "refreshOn": [],
                    "type": "container",
                    "input": true,
                    "components": [
                      {
                        "label": {
                          "en": "Columns"
                        },
                        "hideLabel": true,
                        "key": "columns8",
                        "columns": [
                          {
                            "components": [
                              {
                                "label": {
                                  "en": "Path",
                                  "ru": "Путь"
                                },
                                "key": "path",
                                "clearOnHide": false,
                                "defaultValue": "",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "textfield",
                                "input": true
                              }
                            ],
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 0
                          },
                          {
                            "type": "column",
                            "input": false,
                            "key": "column",
                            "index": 1,
                            "components": [
                              {
                                "label": {
                                  "en": "Preview path",
                                  "ru": "Путь предпросмотра"
                                },
                                "key": "previewPath",
                                "clearOnHide": false,
                                "defaultValue": "",
                                "refreshOn": [],
                                "optionalWhenDisabled": false,
                                "type": "textfield",
                                "input": true
                              }
                            ]
                          }
                        ],
                        "type": "columns",
                        "input": false,
                        "tab": 6
                      }
                    ],
                    "tab": 6
                  }
                ]
              }
            ],
            "type": "tabs",
            "input": false
          }
        ],
        "input": false
      },
      {
        "columns": [
          {
            "type": "column",
            "md": 3,
            "index": 0,
            "components": [
              {
                "label": {
                  "ru": "Отменить",
                  "en": "Cancel"
                },
                "key": "submit2",
                "action": "event",
                "state": "",
                "showValidations": false,
                "event": "cancel",
                "block": true,
                "refreshOn": [],
                "optionalWhenDisabled": false,
                "type": "button",
                "input": true
              }
            ],
            "key": "column",
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false
          },
          {
            "type": "column",
            "index": 1,
            "components": [],
            "key": "column",
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false,
            "md": 3
          },
          {
            "components": [],
            "type": "column",
            "md": 3,
            "key": "column",
            "index": 2,
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false
          },
          {
            "md": 3,
            "type": "column",
            "input": false,
            "key": "column",
            "index": 3,
            "components": [
              {
                "label": {
                  "ru": "Сохранить",
                  "en": "Submit"
                },
                "key": "submit",
                "state": "",
                "theme": "primary",
                "block": true,
                "disableOnInvalid": true,
                "refreshOn": [],
                "optionalWhenDisabled": false,
                "type": "button",
                "input": true
              }
            ]
          }
        ],
        "key": "columns2",
        "type": "columns",
        "input": false
      }
    ],
    "display": "form"
  },
  "attributes": {}
}
