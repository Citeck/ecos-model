{
  "id": "ecos-type",
  "formKey": "module_model/type",
  "title": {
    "en": "Type form"
  },
  "description": {
    "en": ""
  },
  "customModule": null,
  "typeRef": "emodel/type@type",
  "width": "extra-lg",
  "i18n": null,
  "definition": {
    "components": [
      {
        "scrollableContent": true,
        "key": "panel3",
        "type": "panel",
        "components": [
          {
            "components": [
              {
                "label": "Main",
                "key": "main",
                "components": [
                  {
                    "columns": [
                      {
                        "components": [
                          {
                            "defaultValue": "",
                            "type": "textfield",
                            "key": "moduleId",
                            "validate": {
                              "required": true
                            },
                            "label": "id",
                            "input": true
                          },
                          {
                            "type": "selectJournal",
                            "journalId": "ecos-types",
                            "key": "parent",
                            "label": "Parent",
                            "presetFilterPredicatesJs": null,
                            "input": true
                          },
                          {
                            "hideLabel": true,
                            "columns": [
                              {
                                "components": [
                                  {
                                    "type": "selectJournal",
                                    "journalId": "ecos-forms",
                                    "key": "form",
                                    "label": "Form",
                                    "input": true
                                  }
                                ],
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 0,
                                "md": 8
                              },
                              {
                                "type": "column",
                                "input": false,
                                "key": "column",
                                "index": 1,
                                "components": [
                                  {
                                    "label": "Inherit Form",
                                    "labelPosition": "",
                                    "key": "inheritForm",
                                    "type": "checkbox",
                                    "input": true
                                  }
                                ],
                                "md": 4
                              }
                            ],
                            "key": "columns",
                            "type": "columns",
                            "input": false
                          },
                          {
                            "label": "Journal",
                            "journalId": "ecos-journals",
                            "key": "journal",
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": "Number template",
                            "journalId": "number-templates",
                            "key": "numTemplateRef",
                            "type": "selectJournal",
                            "input": true
                          },
                          {
                            "label": "Inherit number template",
                            "key": "inheritNumTemplate",
                            "type": "checkbox",
                            "input": true
                          },
                          {
                            "label": "Edit config",
                            "action": "custom",
                            "state": "",
                            "showValidations": false,
                            "custom": "var ownerId = Math.random().toString();\nvar currentRecord = Citeck.Records.get(instance.options.recordId);\n\nvar configFormRef = data.configFormRef;\nif (Array.isArray(configFormRef)) {\n    configFormRef = configFormRef[0];\n}\n\nif (!configFormRef && data.parent) {\n    configFormRef = Citeck.Records.get(data.parent).load('inhConfigFormRef?id', true);\n}\n\nPromise.all([configFormRef, currentRecord.load('config?json')])\n    .then(function(formAndConfig) {\n\n        var formRef = formAndConfig[0];\n        var config = formAndConfig[1];\n\n        if (formRef == null) {\n            throw new Error(\"Config form is not set\");\n        }\n\n        if (!config) {\n            config = {};\n        }\n\n        var configRecord = Citeck.Records.create(config, ownerId);\n\n        Citeck.forms.eform(configRecord.id, {\n            params: {\n                formId: formRef,\n                onSubmit: function (record) {\n                    var data = record.toJson().attributes;\n                    var resData = {};\n                    for (var key in data) {\n                        if (key[0] !== '_' && key !== 'pendingUpdate') {\n                            resData[key] = data[key];\n                        }\n                    }\n                    currentRecord.att(\"config?json\", resData);\n                    Citeck.Records.release(configRecord.id, ownerId);\n                },\n                onCancel: function () {\n                    Citeck.Records.release(configRecord.id, ownerId);\n                },\n                saveOnSubmit: false\n            },\n            class: 'ecos-modal_width-lg',\n            isBigHeader: true\n        });\n    })",
                            "block": true,
                            "key": "editconfig",
                            "type": "button",
                            "input": true
                          },
                          {
                            "label": "Config form",
                            "journalId": "ecos-forms",
                            "key": "configFormRef",
                            "type": "selectJournal",
                            "input": true
                          }
                        ],
                        "type": "column",
                        "key": "column",
                        "index": 0,
                        "conditional": {
                          "show": null,
                          "when": null
                        },
                        "input": false
                      },
                      {
                        "index": 1,
                        "type": "column",
                        "key": "column",
                        "components": [
                          {
                            "label": "Name",
                            "key": "name",
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "label": "Display Name Template",
                            "key": "dispNameTemplate",
                            "type": "mlText",
                            "input": true
                          },
                          {
                            "defaultValue": "",
                            "type": "textarea",
                            "key": "description",
                            "label": "Description",
                            "properties": {
                              "attribute": "description"
                            },
                            "input": true
                          },
                          {
                            "type": "selectJournal",
                            "journalId": "ui-actions",
                            "reorder": false,
                            "key": "actions",
                            "multiple": true,
                            "label": "Actions",
                            "input": true
                          },
                          {
                            "type": "checkbox",
                            "key": "inheritActions",
                            "label": "Inherit actions",
                            "input": true
                          },
                          {
                            "label": "Attributes",
                            "keyLabel": "",
                            "key": "attributes",
                            "type": "datamap",
                            "valueComponent": {
                              "type": "textfield",
                              "key": "value",
                              "label": "Value",
                              "defaultValue": "Value",
                              "input": true,
                              "conditional": {
                                "show": null,
                                "when": null,
                                "eq": "",
                                "json": ""
                              }
                            },
                            "input": true
                          }
                        ],
                        "conditional": {
                          "show": null,
                          "when": null
                        },
                        "input": false
                      }
                    ],
                    "key": "columns4",
                    "type": "columns",
                    "tab": 0,
                    "input": false
                  }
                ]
              },
              {
                "label": "Create variants",
                "key": "createVariants",
                "components": [
                  {
                    "label": "Create variants",
                    "hideLabel": true,
                    "disableAddingRemovingRows": false,
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "textField": "",
                        "container": {},
                        "attribute": "",
                        "name": {
                          "ru": "",
                          "en": ""
                        },
                        "target": "",
                        "direction": "TARGET",
                        "id2": "",
                        "attribute2": "",
                        "name3": {
                          "ru": "",
                          "en": ""
                        },
                        "recordRef": "",
                        "formRef": "",
                        "selectJournal": "",
                        "value": "Value",
                        "attributes": {},
                        "mlText": {
                          "ru": "",
                          "en": ""
                        }
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "createVariants",
                    "type": "datagrid",
                    "components": [
                      {
                        "key": "panel5",
                        "type": "panel",
                        "components": [
                          {
                            "label": "Id",
                            "defaultValue": "",
                            "key": "id",
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": "Record Ref",
                            "defaultValue": "",
                            "key": "recordRef",
                            "type": "textfield",
                            "input": true
                          }
                        ],
                        "row": "0-0",
                        "input": false
                      },
                      {
                        "key": "panel7",
                        "type": "panel",
                        "components": [
                          {
                            "label": "Name",
                            "key": "name",
                            "type": "mlText",
                            "input": true
                          }
                        ],
                        "row": "0-1",
                        "input": false
                      },
                      {
                        "key": "panel6",
                        "type": "panel",
                        "components": [
                          {
                            "label": "Form",
                            "journalId": "ecos-forms",
                            "key": "formRef",
                            "type": "selectJournal",
                            "customPredicateJs": null,
                            "presetFilterPredicatesJs": null,
                            "input": true
                          },
                          {
                            "label": "Attributes",
                            "keyLabel": "",
                            "key": "attributes",
                            "type": "datamap",
                            "valueComponent": {
                              "type": "textfield",
                              "key": "value",
                              "label": "Value",
                              "defaultValue": "Value",
                              "input": true,
                              "conditional": {
                                "show": null,
                                "when": null,
                                "eq": "",
                                "json": ""
                              }
                            },
                            "input": true
                          }
                        ],
                        "row": "0-2",
                        "input": false
                      }
                    ],
                    "tab": 2,
                    "addAnother": "",
                    "addAnotherPosition": "bottom",
                    "removePlacement": "col",
                    "input": true
                  }
                ]
              },
              {
                "label": "Associations",
                "key": "associations",
                "components": [
                  {
                    "label": "Associations",
                    "hideLabel": true,
                    "disableAddingRemovingRows": true,
                    "defaultOpen": false,
                    "layoutFixed": false,
                    "enableRowGroups": false,
                    "multiple": true,
                    "reorder": true,
                    "defaultValue": [
                      {
                        "id": "",
                        "textField": "",
                        "container": {},
                        "attribute": "",
                        "name": {
                          "ru": "",
                          "en": ""
                        },
                        "target": "",
                        "direction": "TARGET",
                        "mlText": {
                          "ru": "",
                          "en": ""
                        }
                      }
                    ],
                    "validate": {
                      "minLength": "",
                      "maxLength": ""
                    },
                    "key": "associations",
                    "type": "datagrid",
                    "components": [
                      {
                        "key": "panel",
                        "type": "panel",
                        "components": [
                          {
                            "label": "Id",
                            "defaultValue": "",
                            "key": "id",
                            "type": "textfield",
                            "input": true
                          },
                          {
                            "label": "Attribute",
                            "defaultValue": "",
                            "key": "attribute",
                            "type": "textfield",
                            "input": true
                          }
                        ],
                        "row": "0-0",
                        "input": false
                      },
                      {
                        "key": "panel2",
                        "type": "panel",
                        "components": [
                          {
                            "label": "Name",
                            "key": "name",
                            "type": "mlText",
                            "input": true
                          }
                        ],
                        "row": "0-1",
                        "input": false
                      },
                      {
                        "key": "panel4",
                        "type": "panel",
                        "components": [
                          {
                            "label": "Target",
                            "journalId": "ecos-types",
                            "key": "target",
                            "type": "selectJournal",
                            "customPredicateJs": null,
                            "presetFilterPredicatesJs": null,
                            "input": true
                          },
                          {
                            "label": "Direction",
                            "dataSrc": "values",
                            "data": {
                              "values": [
                                {
                                  "label": "Target",
                                  "value": "TARGET"
                                },
                                {
                                  "label": "Source",
                                  "value": "SOURCE"
                                },
                                {
                                  "label": "Both",
                                  "value": "BOTH"
                                }
                              ]
                            },
                            "defaultValue": "TARGET",
                            "key": "direction",
                            "type": "ecosSelect",
                            "input": true
                          }
                        ],
                        "row": "0-2",
                        "input": false
                      }
                    ],
                    "tab": 2,
                    "input": true
                  }
                ]
              }
            ],
            "key": "tabs",
            "type": "tabs",
            "input": false
          }
        ],
        "input": false
      },
      {
        "type": "columns",
        "columns": [
          {
            "type": "column",
            "md": 3,
            "index": 0,
            "components": [
              {
                "type": "button",
                "action": "event",
                "block": true,
                "state": "",
                "showValidations": false,
                "event": "cancel",
                "key": "submit2",
                "label": "Cancel",
                "conditional": {
                  "show": null,
                  "when": null
                },
                "input": true
              }
            ],
            "key": "column",
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false
          },
          {
            "type": "column",
            "index": 1,
            "components": [],
            "key": "column",
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false
          },
          {
            "components": [
              {
                "type": "button",
                "disableOnInvalid": true,
                "block": true,
                "state": "",
                "theme": "primary",
                "key": "submit",
                "input": true
              }
            ],
            "type": "column",
            "md": 3,
            "key": "column",
            "index": 2,
            "conditional": {
              "show": null,
              "when": null
            },
            "input": false
          }
        ],
        "key": "columns2",
        "input": false
      }
    ],
    "display": "form"
  },
  "attributes": {}
}
